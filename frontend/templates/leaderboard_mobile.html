<!doctype html>
{% load static %}
<html lang="{{ meta.lang|default:'en' }}">
    <head>
        {% include "partials/ga_head.html" %}
        {% include "partials/gtm_head.html" %}
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
        <title>{{ meta.title|default:"LinkHash | Leaderboard" }}</title>
        <link rel="canonical" href="{{ meta.canonical|default:meta.url }}">
        <meta name="robots" content="index,follow">
        <meta name="author" content="LinkHash">
        <meta name="description" content="{{ meta.description|default:'Top contributors ranked by campaign participation.' }}">
        <!-- OG/Twitter -->
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="LinkHash">
        <meta property="og:title" content="{{ meta.og_title|default:meta.title }}">
        <meta property="og:description" content="{{ meta.og_description|default:meta.description }}">
        <meta property="og:url" content="{{ meta.url }}">
        <meta property="og:image" content="{% static 'img/og-cover.png' %}">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="{{ meta.og_title|default:meta.title }}">
        <meta name="twitter:description" content="{{ meta.og_description|default:meta.description }}">
        <meta name="twitter:image" content="{% static 'img/twitter-card.png' %}">
        <!-- Favicons -->
        <link rel="icon" href="{% static 'img/favicon.ico' %}">
        <style>
      :root{
        --bg:#0a0b0d; --bg-elev:#0f1115; --panel:#11141a; --panel-2:#0e1318; --grid:#0b0f13; --line:#1a212d;
        --text:#e6f1ee; --muted:#9fb0aa; --green:#16a34a; --green-2:#23d16a;
        --glow:0 0 22px rgba(22,163,74,.35), 0 0 48px rgba(22,163,74,.15);
        --radius:16px; --shadow-lg:0 30px 60px rgba(0,0,0,.55), inset 0 -1px 0 rgba(255,255,255,.03);
        --shadow-md:0 14px 34px rgba(0,0,0,.45);
        --noise:transparent url('data:image/svg+xml;utf8,\
          <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120">\
            <filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter>\
            <rect width="120" height="120" filter="url(%23n)" opacity=".04"/></svg>') repeat;
        --container:clamp(320px, 92vw, 860px);
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0; color:var(--text);
        background:
          radial-gradient(40rem 30rem at 90% -10%, rgba(22,163,74,.12), transparent 60%),
          radial-gradient(30rem 20rem at -20% 20%, rgba(35,209,106,.08), transparent 60%),
          linear-gradient(180deg, #08090b, #0a0b0d 20%, #090c10);
        font-family: ui-sans-serif, "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                     "Apple SD Gothic Neo", "Noto Sans KR", "Noto Sans JP", "Noto Sans SC", Arial, sans-serif;
        letter-spacing:.2px; background-attachment:fixed;
      }
      a{color:inherit;text-decoration:none}
      .container{width:var(--container); margin:0 auto; padding:0 10px;}

      /* ===== MOBILE HEADER (namespaced .mnav) ===== */
      .mnav{position:sticky; top:0; z-index:80; padding-top:env(safe-area-inset-top);
        background:linear-gradient(180deg, rgba(15,17,21,.82), rgba(15,17,21,.52));
        backdrop-filter: blur(12px); border-bottom:1px solid rgba(255,255,255,.06);}
      .mnav-bar{display:flex; align-items:center; justify-content:space-between; height:56px; gap:8px;}
      .mnav-brand{display:inline-flex; align-items:center; gap:8px; font-weight:800; color:#d8ffe7; text-shadow:0 0 14px rgba(35,209,106,.22);}
      .mnav-brand .dot{width:8px;height:8px;border-radius:999px;background:#16a34a;box-shadow:0 0 16px rgba(22,163,74,.42)}
      .mnav-brand .name{font-size:16px; letter-spacing:.2px}
      .mnav-actions{display:flex; align-items:center; gap:8px;}
      /* How-to pills (header actions) */
      .mnav .howto{display:flex; align-items:center; gap:8px;}
      .mnav .howto-label{font-weight:800; color:#cfe7dd; opacity:.95; font-size:14px; white-space:nowrap;}

      /* Icon-only pills sized like the hamburger (36x36 with 22px glyph) */
      .mnav .pill{
        display:inline-flex; align-items:center; justify-content:center;
        width:36px; height:36px; border-radius:10px;
        border:1px solid #2a333f; background:#0b1117; color:#e6f1ee;
        transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      }
      .mnav .pill:hover{ border-color:rgba(35,209,106,.35); box-shadow:0 0 16px rgba(35,209,106,.18) }
      .mnav .pill:active{ transform:translateY(1px) }
      .mnav .icon{ width:22px; height:22px; display:inline-block; }
      .mnav .icon svg{ width:22px; height:22px; display:block; }

      @media (max-width:360px){
        .mnav .howto-label{ display:none; } /* keep it tidy on very small screens */
      }

      .mnav .btn{display:inline-flex; align-items:center; gap:6px; padding:8px 10px; font-weight:800; border-radius:10px; border:1px solid #2fe07a;
        background:linear-gradient(180deg,#19b357,#119e49); color:#05160c; box-shadow:0 0 22px rgba(22,163,74,.25);}
      .mnav .pill-addr{max-width:130px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; border:1px solid #2a333f; background:#0b1117;
        color:#d9f6e6; border-radius:999px; padding:6px 10px; font-size:12px; font-weight:700;}
      .mnav-toggle{display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:10px;
        border:1px solid #2a333f; background:#0b1117; color:#e6f1ee;}
      .mnav-toggle:active{transform:scale(.98)}
      .mnav-sheet{position:relative; background:linear-gradient(180deg,#0f1419,#0c1116);
        border-top:1px solid rgba(255,255,255,.06); box-shadow:0 30px 60px rgba(0,0,0,.5);
        padding:12px 12px calc(12px + env(safe-area-inset-bottom));}
      .mnav-sheet[hidden]{display:none;}
      .mnav-list{display:grid; gap:8px; margin:4px 0 10px;}
      .mnav-list .item{display:flex; align-items:center; gap:8px; padding:12px 12px; border-radius:12px; font-weight:800;
        border:1px solid #263040; background:rgba(14,18,25,.65); color:#cfe7dd;}
      .mnav-list .item:hover{border-color:rgba(35,209,106,.35); box-shadow:0 0 16px rgba(35,209,106,.18)}
      .mnav-list .item.active{color:#05160c; border-color:#2fe07a; background:linear-gradient(180deg,#19b357,#119e49); box-shadow:0 0 22px rgba(22,163,74,.25)}
      .mnav-list .item.outline{background:#0b1117}
      .mnav-lang{margin:2px 0 10px; position:relative;}
      .mnav .lang-btn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; font-weight:800; border-radius:12px; border:1px solid #2a333f; background:#0b1117; color:#cfe7dd}
      .mnav .flag-emoji{display:inline-flex; align-items:center; justify-content:center; width:18px; height:18px; line-height:18px; font-size:14px; border-radius:3px;
        background:rgba(255,255,255,.06); box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);}
      .mnav .lang-menu{position:absolute; top:110%; left:0; min-width:200px; padding:6px; margin:0; list-style:none; display:none; z-index:90;
        background:linear-gradient(180deg,#0f1419,#0c1116); border:1px solid rgba(255,255,255,.08); border-radius:12px; box-shadow:0 20px 40px rgba(0,0,0,.45)}
      .mnav .lang.open .lang-menu,
      .mnav .mnav-lang.open .lang-menu{display:block; animation:mnavMenuIn .14s ease-out}

      @keyframes mnavMenuIn{from{transform:translateY(-6px);opacity:0} to{transform:translateY(0);opacity:1}}
      .mnav .lang-item{display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; cursor:pointer; color:#cfe7dd; font-weight:700;}
      .mnav .lang-item:hover{ background:#0b1218; border:1px solid #1d2836 }
      .mnav .danger{width:100%; margin-top:6px; padding:11px 12px; border-radius:12px; border:1px solid #3b2020;
        background:linear-gradient(180deg,#6e2c2c,#5a2222); color:#ffeaea; font-weight:800}
      @media (max-width:360px){ .mnav .pill-addr{max-width:98px} .mnav-bar{height:52px} .mnav-brand .name{font-size:15px} }
      @media (min-width:720px){ .mnav-bar{height:60px} }

      /* HEADER */
      .page-head{
        padding:28px 0 10px;
        background:linear-gradient(180deg, rgba(12,16,20,.65), rgba(10,12,16,.35)), var(--noise);
        border-bottom:1px solid rgba(255,255,255,.06);
      }
      .page-head h1{margin:0 0 6px; font-size:24px;}
      .page-head .sub{color:var(--muted); margin:0; font-size:14px}
      .range{display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:10px;}
      .chip{padding:8px 12px; border-radius:999px; border:1px solid #2a333f; background:#0b1117; color:#cfe7dd; font-weight:800; font-size:12px;}
      .chip.active{border-color:#2fe07a; background:linear-gradient(180deg,#19b357,#119e49); color:#05160c; box-shadow:var(--glow)}

      /* LIST / CARDS */
      .section{padding:12px 0 20px;}
      .card{background:linear-gradient(180deg, #0f1419, #0c1116); border:1px solid rgba(255,255,255,.06); border-radius:16px; box-shadow:var(--shadow-md); padding:12px; margin-top:12px}

      /* Clickable row */
      .row-item{
        position:relative;
        display:grid;
        grid-template-columns: auto 1fr auto auto; /* rank | handle | net | points */
        gap:12px;
        border:1px solid rgba(255,255,255,.06);
        border-radius:14px;
        padding:12px;
        background:linear-gradient(180deg, #0d1217, #0b0f14);
        transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease, background .18s ease;
        cursor:pointer;
      }
      .row-item:hover,
      .row-item:focus-visible{
        transform:translateY(-2px) scale(1.01);
        border-color:#2fe07a;
        box-shadow:0 30px 60px rgba(22,163,74,.18), var(--shadow-md);
        outline:none;
      }

      .rank-badge{min-width:36px; height:36px; display:flex; align-items:center; justify-content:center; font-weight:900; border-radius:10px; background:#0b1117; border:1px solid #1d2836;}

      .handle{display:flex; flex-direction:column; gap:4px; min-width:0;}
      .addr{font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
      .muted{color:#9fb0aa; font-size:12px;}

      /* Network block sits to the RIGHT of address; logo on top, name text under */
      .net{display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px; min-width:58px;}
      .net img{width:24px; height:24px; display:block; filter:drop-shadow(0 2px 6px rgba(0,0,0,.35));}
      .net-name{font-size:11px; color:#cfe7dd; text-align:center; line-height:1.1; white-space:nowrap; max-width:80px; overflow:hidden; text-overflow:ellipsis;}

      .points{display:flex; align-items:center; gap:6px; font-weight:900; justify-self:end;}
      .points .val{font-size:16px;}

      .split{margin-top:10px; grid-column: 1 / -1;}
      .bar-split{
        height:10px;
        border:1px solid #1d2836;
        background:
          linear-gradient(
            90deg,
            #19b357 0,
            #23d16a var(--links, 50%),
            #1d6dd3 var(--links, 50%),
            #5aa9ff 100%
          );
        border-radius:999px;
        overflow:hidden;
      }
      .split-meta{display:flex; justify-content:space-between; margin-top:6px; font-size:12px; color:#9fb0aa}

      .empty{padding:20px; text-align:center; color:#a8bab2; border:1px dashed #243040; border-radius:14px; background:#0a1117; }

      /* FOOTER */
      .footer{padding:18px 0 24px; border-top:1px solid rgba(255,255,255,.06); color:#a7b9b1; background:#0a0c10; font-size:12px; margin-top:18px}
        </style>
    </head>
    <body>
        {% include "partials/gtm_body.html" %}
        <!-- ===== MOBILE HEADER ===== -->
        <header class="mnav" role="banner">
            <div class="container mnav-bar">
                <a href="{% if meta.lang == 'ko' %}/ko/{% elif meta.lang == 'ja' %}/ja/{% elif meta.lang == 'zh' %}/zh/{% else %}/{% endif %}" class="mnav-brand" aria-label="LinkHash Home">
                    <span class="dot" aria-hidden="true"></span>
                    <span class="name">LinkHash</span>
                </a>
                <div class="mnav-actions">
                    {% with ig=meta.instagram_guide_url|default:'https://www.instagram.com/' tw=meta.twitter_guide_url|default:'https://x.com/' %}
                    <div class="howto">
                        <span class="howto-label">
                            {% if meta.lang == 'ko' %}이용 방법:{% elif meta.lang == 'ja' %}使い方:{% elif meta.lang == 'zh' %}使用方法：{% else %}How to use:{% endif %}
                        </span>
                        <!-- Instagram guide (icon only) -->
                        <a
                            class="pill"
                            href="{{ ig }}"
                            target="_blank"
                            rel="noopener"
                            aria-label="{% if meta.lang == 'ko' %}인스타그램 가이드{% elif meta.lang == 'ja' %}Instagramガイド{% elif meta.lang == 'zh' %}Instagram 指南{% else %}Instagram Guide{% endif %}"
                            title="{% if meta.lang == 'ko' %}인스타그램 가이드{% elif meta.lang == 'ja' %}Instagramガイド{% elif meta.lang == 'zh' %}Instagram 指南{% else %}Instagram Guide{% endif %}"
                        >
                            <span class="icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                    <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5a5.5 5.5 0 1 1 0 11 5.5 5.5 0 0 1 0-11zm0 2a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7zM18.5 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                                </svg>
                            </span>
                        </a>
                        <!-- X (Twitter) guide (icon only) -->
                        <a
                            class="pill"
                            href="{{ tw }}"
                            target="_blank"
                            rel="noopener"
                            aria-label="{% if meta.lang == 'ko' %}X 가이드{% elif meta.lang == 'ja' %}Xガイド{% elif meta.lang == 'zh' %}X 指南{% else %}X Guide{% endif %}"
                            title="{% if meta.lang == 'ko' %}X 가이드{% elif meta.lang == 'ja' %}Xガイド{% elif meta.lang == 'zh' %}X 指南{% else %}X Guide{% endif %}"
                        >
                            <span class="icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                    <path d="M3 3h3.3l5.3 7.2L15.9 3H21l-8.1 10.6L21 21h-3.3l-6-8.1L8.1 21H3l8-10.4L3 3z"/>
                                </svg>
                            </span>
                        </a>
                    </div>
                    {% endwith %}
                    <button
                        class="mnav-toggle"
                        id="mnavToggle"
                        type="button"
                        aria-controls="mnavSheet"
                        aria-expanded="false"
                        aria-label="Menu"
                    >
                        <svg
                            viewBox="0 0 24 24"
                            width="22"
                            height="22"
                            aria-hidden="true"
                        >
                            <path
                                d="M4 6h16M4 12h16M4 18h16"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                        </svg>
                    </button>
                </div>
            </div>
            <!-- Slide-down sheet -->
            <div class="mnav-sheet" id="mnavSheet" hidden>
                <nav class="mnav-list" aria-label="Primary">
                    <a class="item" href="{% if meta.lang == 'ko' %}/ko/{% elif meta.lang == 'ja' %}/ja/{% elif meta.lang == 'zh' %}/zh/{% else %}/{% endif %}">
                        🏠 {% if meta.lang == 'ko' %}홈{% elif meta.lang == 'ja' %}ホーム{% elif meta.lang == 'zh' %}主页{% else %}Home{% endif %}
                    </a>
                    <a class="item" href="{% if meta.lang == 'ko' %}/ko/rewards/{% elif meta.lang == 'ja' %}/ja/rewards/{% elif meta.lang == 'zh' %}/zh/rewards/{% else %}/rewards/{% endif %}">
                        🎁 {% if meta.lang == 'ko' %}리워드{% elif meta.lang == 'ja' %}リワード{% elif meta.lang == 'zh' %}奖励{% else %}Rewards{% endif %}
                    </a>
                    <a class="item" href="{% if meta.lang == 'ko' %}/ko/events/{% elif meta.lang == 'ja' %}/ja/events/{% elif meta.lang == 'zh' %}/zh/events/{% else %}/events/{% endif %}">
                        📣 {% if meta.lang == 'ko' %}이벤트{% elif meta.lang == 'ja' %}イベント{% elif meta.lang == 'zh' %}活动{% else %}Events{% endif %}
                    </a>
                    <a class="item active" href="{% if meta.lang == 'ko' %}/ko/leaderboard/{% elif meta.lang == 'ja' %}/ja/leaderboard/{% elif meta.lang == 'zh' %}/zh/leaderboard/{% else %}/leaderboard/{% endif %}">
                        🏆 {% if meta.lang == 'ko' %}리더보드{% elif meta.lang == 'ja' %}リーダーボード{% elif meta.lang == 'zh' %}排行榜{% else %}Leaderboard{% endif %}
                    </a>
                    <a class="item outline" href="{% if meta.lang == 'ko' %}/rewards/apply/ko/{% elif meta.lang == 'ja' %}/rewards/apply/ja/{% elif meta.lang == 'zh' %}/rewards/apply/zh/{% else %}/rewards/apply/{% endif %}">
                        📝 {% if meta.lang == 'ko' %}캠페인 신청{% elif meta.lang == 'ja' %}キャンペーン申請{% elif meta.lang == 'zh' %}申请发起活动{% else %}Apply for campaign{% endif %}
                    </a>
                </nav>
                <!-- Language switcher -->
                <div class="mnav-lang" id="langSwitcher" data-current="{{ meta.lang|default:'en' }}">
                    <button
                        class="lang-btn"
                        type="button"
                        aria-haspopup="listbox"
                        aria-expanded="false"
                    >
                        <span class="flag-emoji" aria-hidden="true"></span>
                        <span class="label">
                            {% if meta.lang == 'ko' %}한국어{% elif meta.lang == 'ja' %}日本語{% elif meta.lang == 'zh' %}中文{% else %}English{% endif %}
                        </span>
                        <svg
                            class="chev"
                            viewBox="0 0 20 20"
                            width="14"
                            height="14"
                            aria-hidden="true"
                        >
                            <path
                                d="M5 7l5 6 5-6"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                        </svg>
                    </button>
                    <ul
                        class="lang-menu"
                        role="listbox"
                        tabindex="-1"
                        aria-label="Select language"
                    >
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="en"
                            data-flag="🇺🇸"
                        >🇺🇸 English</li>
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="ko"
                            data-flag="🇰🇷"
                        >🇰🇷 한국어</li>
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="ja"
                            data-flag="🇯🇵"
                        >🇯🇵 日本語</li>
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="zh"
                            data-flag="🇨🇳"
                        >🇨🇳 中文</li>
                    </ul>
                </div>
                {% if wallet_user %}
                <button class="danger" type="button" onclick="(window.logoutWallet||(()=>alert('Wallet script missing')))()">
                    {% if meta.lang == 'ko' %}로그아웃{% elif meta.lang == 'ja' %}ログアウト{% elif meta.lang == 'zh' %}退出{% else %}Logout{% endif %}
                </button>
                {% endif %}
            </div>
        </header>
        <!-- HEADER -->
        <section class="page-head">
            <div class="container">
                <h1>
                    {% if meta.lang == 'ko' %}리더보드{% elif meta.lang == 'ja' %}リーダーボード{% elif meta.lang == 'zh' %}排行榜{% else %}Leaderboard{% endif %}
                </h1>
                <p class="sub">
                    {% if meta.lang == 'ko' %}
            캠페인 기여도 기반 순위 (링크·방문·점수).
          {% elif meta.lang == 'ja' %}
            キャンペーン貢献度に基づく順位（リンク・訪問・スコア）。
          {% elif meta.lang == 'zh' %}
            基于活动贡献的排名（外链、访问、积分）。
          {% else %}
            Ranked by campaign contributions (links, visits, score).
          {% endif %}
          {% if using_sample %}
                    <span class="muted"> · UI preview data</span>
                    {% endif %}
                </p>
                <div class="range">
                    <span class="muted">
                        {% if meta.lang == 'ko' %}기간{% elif meta.lang == 'ja' %}期間{% elif meta.lang == 'zh' %}时间范围{% else %}Range{% endif %}:
                    </span>
                    <a class="chip {% if range_code == '7d' %}active{% endif %}" href="?range=7d">7D</a>
                    <a class="chip {% if range_code == '30d' %}active{% endif %}" href="?range=30d">30D</a>
                    <a class="chip {% if range_code == '3m' %}active{% endif %}" href="?range=3m">3M</a>
                    <a class="chip {% if range_code == '6m' %}active{% endif %}" href="?range=6m">6M</a>
                    <a class="chip {% if range_code == '12m' %}active{% endif %}" href="?range=12m">12M</a>
                </div>
            </div>
        </section>
        <!-- LIST -->
        <main class="container section">
            {% if rows %}
        {% for r in rows %}
          {% if r.explorer_url %}
            <a
                class="row-item"
                href="{{ r.explorer_url }}"
                target="_blank"
                rel="noopener"
                aria-label="Open explorer for {{ r.masked }}"
            >
                {% else %}
                <div class="row-item" role="group" aria-label="{{ r.masked }}">
                    {% endif %}
                    <div class="rank-badge">{{ r.rank }}</div>
                    <!-- Left: Address + Mindshare -->
                    <div class="handle">
                        <span class="addr">{{ r.masked }}</span>
                        <span class="muted">
                            {% if meta.lang == 'ko' %}마인드셰어{% elif meta.lang == 'ja' %}マインドシェア{% elif meta.lang == 'zh' %}心智占有率{% else %}Mindshare{% endif %}
                · {{ r.mindshare|floatformat:2 }}%
                        </span>
                    </div>
                    <!-- Middle-right: Network (logo on top, label underneath) -->
                    <div class="net">
                        {% if r.network == 'ETH' %}
                        <img src="{% static 'img/networks/eth.svg' %}" alt="Ethereum">
                        <span class="net-name">{% if meta.lang == 'ko' %}이더리움{% else %}Ethereum{% endif %}</span>
                        {% elif r.network == 'POL' %}
                        <img src="{% static 'img/networks/polygon.svg' %}" alt="Polygon">
                        <span class="net-name">{% if meta.lang == 'ko' %}폴리곤{% else %}Polygon{% endif %}</span>
                        {% elif r.network == 'BNB' %}
                        <img src="{% static 'img/networks/bnb.svg' %}" alt="BNB Chain">
                        <span class="net-name">{% if meta.lang == 'ko' %}BNB 체인{% else %}BNB Chain{% endif %}</span>
                        {% elif r.network == 'SOL' %}
                        <img src="{% static 'img/networks/solana.svg' %}" alt="Solana">
                        <span class="net-name">{% if meta.lang == 'ko' %}솔라나{% else %}Solana{% endif %}</span>
                        {% else %}
                        <!-- No network -->
                        <span class="net-name" style="opacity:.6">—</span>
                        {% endif %}
                    </div>
                    <!-- Right: Points -->
                    <div class="points">
                        <span class="muted">{% if meta.lang == 'ko' %}포인트{% elif meta.lang == 'ja' %}ポイント{% elif meta.lang == 'zh' %}积分{% else %}Points{% endif %}</span>
                        <span class="val">{{ r.points }}</span>
                    </div>
                    <!-- Split bar (full width) -->
                    <div class="split">
                        <div class="bar-split" style="--links: {{ r.ratio_links|floatformat:'2' }}%;" aria-label="Links {{ r.links }}, Visits {{ r.visits }}"></div>
                        <div class="split-meta">
                            <span>
                                {% if meta.lang == 'ko' %}링크{% elif meta.lang == 'ja' %}リンク{% elif meta.lang == 'zh' %}外链{% else %}Links{% endif %}
                  · {{ r.links }}
                            </span>
                            <span>
                                {% if meta.lang == 'ko' %}방문{% elif meta.lang == 'ja' %}訪問{% elif meta.lang == 'zh' %}访问{% else %}Visits{% endif %}
                  · {{ r.visits }}
                            </span>
                        </div>
                    </div>
                    {% if r.explorer_url %}
                </a>
                {% else %}
            </div>
            {% endif %}
        {% endfor %}
      {% else %}
            <div class="empty">
                {% if meta.lang == 'ko' %}
            아직 데이터가 없습니다. 과제에 참여하면 순위가 표시됩니다.
          {% elif meta.lang == 'ja' %}
            まだデータがありません。タスクに参加すると表示されます。
          {% elif meta.lang == 'zh' %}
            暂无数据。参与活动后将显示在此处。
          {% else %}
            No data yet. Participate in campaigns to appear here.
          {% endif %}
            </div>
            {% endif %}
        </main>
        <!-- FOOTER -->
        <footer class="footer">
            <div class="container" style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <div>
                    ©
                    <strong>LinkHash</strong>
                </div>
                <div style="opacity:.7">
                    {% if meta.lang == 'ko' %}화이트햇 백링크 · 투명한 리워드{% elif meta.lang == 'ja' %}ホワイトハット被リンク・透明な報酬{% elif meta.lang == 'zh' %}白帽外链 · 透明奖励{% else %}White-hat backlinks · Transparent rewards{% endif %}
                </div>
            </div>
        </footer>
        <!-- Language switcher -->
        <script>
  (function(){
    const $wrap = document.getElementById('langSwitcher');
    if(!$wrap) return;
    const $btn  = $wrap.querySelector('.lang-btn');
    const $menu = $wrap.querySelector('.lang-menu');
    const current = ($wrap.dataset.current || 'en').toLowerCase();

    const flagEl = $btn.querySelector('.flag-emoji');
    const flagMap = { en:'🇺🇸', ko:'🇰🇷', ja:'🇯🇵', zh:'🇨🇳' };
    flagEl.textContent = flagMap[current] || '🇺🇸';

    function open(){ $wrap.classList.add('open');  $btn.setAttribute('aria-expanded','true'); }
    function close(){ $wrap.classList.remove('open'); $btn.setAttribute('aria-expanded','false'); }

    // Toggle menu; prevent bubbling so global click handler doesn't immediately close it
    $btn.addEventListener('click', (e)=>{ e.stopPropagation(); $wrap.classList.contains('open') ? close() : open(); });
    // Also stop clicks inside the menu from bubbling
    $menu.addEventListener('click', (e)=>{ e.stopPropagation(); });

    document.addEventListener('click', ()=> close());
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') close(); });

    function pathFor(lang){
      const loc = window.location;
      const path = loc.pathname;
      const clean = path.replace(/^\/(ko|ja|zh)(\/|$)/, '/'); // strip locale prefix if any
      const baseMap = { '/': true, '/rewards/': true, '/events/': true, '/leaderboard/': true };

      // /rewards/apply/ variants (kept for consistency)
      const isApply = /^\/rewards\/apply(\/(ko|ja|zh)\/)?$/.test(path);
      if(isApply){
        if(lang === 'en') return '/rewards/apply/?lang=en';
        return `/rewards/apply/${lang}/`;
      }

      if(baseMap[clean]){
        if(lang === 'en'){
          const q = new URLSearchParams(loc.search);
          q.set('lang','en');
          return clean + (q.toString() ? `?${q.toString()}` : '');
        }
        return clean === '/' ? `/${lang}/` : `/${lang}${clean}`;
      }

      // Other pages: keep path, toggle ?lang=
      const params = new URLSearchParams(loc.search);
      params.set('lang', lang);
      return path + (params.toString() ? `?${params.toString()}` : '');
    }

    $menu.querySelectorAll('.lang-item').forEach(li=>{
      li.addEventListener('click', ()=>{
        const lang = li.getAttribute('data-lang');
        const emoji = li.getAttribute('data-flag') || '';
        flagEl.textContent = emoji;
        $wrap.querySelector('.label').textContent =
          lang==='ko' ? '한국어' : lang==='ja' ? '日本語' : lang==='zh' ? '中文' : 'English';
        close();
        const target = pathFor(lang);
        if(target) window.location.href = target;
      });
    });
  })();
        </script>
        <!-- CSRF + Wallet helpers (same pattern as other pages) -->
        <script>
  function getCookie(name){
    const m = document.cookie.match(new RegExp('(^|; )' + encodeURIComponent(name) + '=([^;]*)'));
    return m ? decodeURIComponent(m[2]) : null;
  }
  async function apiGet(url){
    const r = await fetch(url, { credentials: 'same-origin' });
    if(!r.ok) throw new Error((await r.text()) || ('GET ' + url + ' failed'));
    return r.json();
  }
  async function apiPost(url, json){
    const r = await fetch(url, {
      method: 'POST',
      credentials: 'same-origin',
      headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') || '' },
      body: JSON.stringify(json || {})
    });
    if(!r.ok){
      let msg; try{ msg = (await r.json()).error }catch(e){ msg = await r.text(); }
      throw new Error(msg || ('POST ' + url + ' failed'));
    }
    return r.json();
  }

  function pickEthereumProvider(){
    const eth = window.ethereum;
    if(!eth) return null;
    if(Array.isArray(eth.providers)){
      const mm = eth.providers.find(p => p.isMetaMask);
      return mm || eth.providers[0] || eth;
    }
    return eth;
  }
  function isMobile(){ return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent || ''); }
  function buildMetaMaskDeepLink(){
    const dapp = location.host + location.pathname + location.search + location.hash;
    return 'https://metamask.app.link/dapp/' + dapp;
  }
  async function connectWallet(){
    try{
      const provider = pickEthereumProvider();
      if(!provider){
        if(isMobile()) window.location.href = buildMetaMaskDeepLink();
        else alert('MetaMask not detected. Please install MetaMask and refresh.');
        return;
      }
      const accounts = await provider.request({ method: 'eth_requestAccounts' });
      const address = (accounts && accounts[0]) ? accounts[0] : null;
      if(!address){ alert('No account selected.'); return; }
      const nonceRes = await apiGet(`/api/auth/nonce?address=${encodeURIComponent(address)}`);
      if(!nonceRes.ok){ throw new Error(nonceRes.error || 'nonce error'); }
      const message = nonceRes.message || `LinkHash login\n\nNonce: ${nonceRes.nonce}\n\nThis signature proves you control this wallet.`;
      const signature = await provider.request({ method: 'personal_sign', params: [ message, address ] });
      const verifyRes = await apiPost('/api/auth/verify', { address, signature, message });
      if(verifyRes && verifyRes.ok) window.location.reload();
      else alert('Login failed.');
    }catch(err){
      console.error(err);
      alert('Wallet login failed: ' + (err && err.message ? err.message : err));
    }
  }
  async function logoutWallet(){
    try{ await apiPost('/api/auth/logout', {}); window.location.reload(); }
    catch(err){ console.error(err); alert('Logout failed: ' + (err && err.message ? err.message : err)); }
  }
  window.connectWallet = connectWallet;
  window.logoutWallet  = logoutWallet;
        </script>
        <script>
(function(){
  const $toggle = document.getElementById('mnavToggle');
  const $sheet  = document.getElementById('mnavSheet');
  if($toggle && $sheet){
    const open = ()=>{ $sheet.hidden = false; $toggle.setAttribute('aria-expanded','true'); document.documentElement.style.overflow='hidden'; };
    const close= ()=>{ $sheet.hidden = true;  $toggle.setAttribute('aria-expanded','false'); document.documentElement.style.overflow=''; };
    $toggle.addEventListener('click', ()=> $sheet.hidden ? open() : close());
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') close(); });
    document.addEventListener('click', (e)=>{
      if($sheet.hidden) return;
      const within = e.target.closest('#mnavSheet') || e.target.closest('#mnavToggle');
      if(!within) close();
    });
  }
})();
        </script>
    </body>
</html>
