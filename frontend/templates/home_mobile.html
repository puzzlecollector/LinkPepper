<!doctype html>
{% load static %}
<html lang="{{ meta.lang|default:'en' }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
        <title>{{ meta.title|default:"LinkHash | Web3 SEO Rewards" }}</title>
        <link rel="canonical" href="{{ meta.canonical|default:meta.url }}">
        <meta name="robots" content="index,follow">
        <meta name="author" content="LinkHash">
        <meta name="description" content="{{ meta.description|default:'Data-driven backlinks & web3 rewards platform.' }}">
        <!-- OG/Twitter -->
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="LinkHash">
        <meta property="og:title" content="{{ meta.og_title|default:meta.title }}">
        <meta property="og:description" content="{{ meta.og_description|default:meta.description }}">
        <meta property="og:url" content="{{ meta.url }}">
        <meta property="og:image" content="{% static 'img/og-cover.png' %}">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="{{ meta.og_title|default:meta.title }}">
        <meta name="twitter:description" content="{{ meta.og_description|default:meta.description }}">
        <meta name="twitter:image" content="{% static 'img/twitter-card.png' %}">
        <!-- Favicons -->
        <link rel="icon" href="{% static 'img/favicon.ico' %}">
        <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/apple-touch-icon.png' %}">
        <style>
      /* ======= THEME (mobile-first) ======= */
      :root{
        --bg:#0a0b0d; --bg-elev:#0f1115; --panel:#11141a; --panel-2:#0e1318; --grid:#0b0f13; --line:#1a212d;
        --text:#e6f1ee; --muted:#9fb0aa; --green:#16a34a; --green-2:#23d16a;
        --glow:0 0 22px rgba(22,163,74,.35), 0 0 48px rgba(22,163,74,.15);
        --radius:14px; --shadow-lg:0 30px 60px rgba(0,0,0,.55), inset 0 -1px 0 rgba(255,255,255,.03);
        --shadow-md:0 14px 34px rgba(0,0,0,.45);
        --noise:transparent url('data:image/svg+xml;utf8,\
          <svg xmlns="http://www.w3.org/2000/svg" width=\"120\" height=\"120\" viewBox=\"0 0 120 120\">\
          <filter id=\"n\"><feTurbulence type=\"fractalNoise\" baseFrequency=\"0.9\" numOctaves=\"2\" stitchTiles=\"stitch\"/></filter>\
          <rect width=\"120\" height=\"120\" filter=\"url(%23n)\" opacity=\".04\"/></svg>') repeat;
        --container:clamp(320px, 92vw, 840px);
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0; color:var(--text);
        background:
          radial-gradient(40rem 30rem at 90% -10%, rgba(22,163,74,.12), transparent 60%),
          radial-gradient(30rem 20rem at -20% 20%, rgba(35,209,106,.08), transparent 60%),
          linear-gradient(180deg, #08090b, #0a0b0d 20%, #090c10);
        font-family: ui-sans-serif, "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                     "Apple SD Gothic Neo", "Noto Sans KR", "Noto Sans JP", "Noto Sans SC", Arial, sans-serif;
        letter-spacing:.2px;
        background-attachment: fixed;
      }
      a{color:inherit;text-decoration:none}
      .container{width:var(--container); margin:0 auto; padding:0 6px;}

      /* ===== NAV (compact, sticky) ===== */
      .nav{
        position:sticky; top:0; z-index:60; backdrop-filter: blur(12px);
        background:linear-gradient(180deg, rgba(15,17,21,.75), rgba(15,17,21,.45));
        border-bottom:1px solid rgba(255,255,255,.06);
      }
      .nav .row{display:flex; align-items:center; justify-content:space-between; height:64px; gap:10px;}
      .brand{display:flex; align-items:center; gap:8px; font-weight:800; letter-spacing:.3px; color:#d8ffe7; text-shadow:0 0 18px rgba(35,209,106,.24);}
      .brand .dot{width:8px;height:8px;border-radius:999px;background:var(--green);box-shadow:var(--glow)}
      .links{display:flex; align-items:center; gap:10px;}
      .link-min{padding:8px 10px; border-radius:10px; border:1px solid #2a333f; background: rgba(14,18,25,.6); color:#d9f6e6; font-weight:700; font-size:12px}
      .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; font-weight:800; border-radius:12px; background:linear-gradient(180deg,#19b357,#119e49); color:#05160c; box-shadow:var(--glow); border:1px solid #2fe07a; font-size:13px}
      .btn-outline{padding:8px 10px; border-radius:10px; border:1px solid #2a333f; background: rgba(14,18,25,.6); color:#d9f6e6; font-weight:700; font-size:12px}
      .pill-addr{max-width:140px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}

      /* Language dropdown */
      .lang{ position:relative;}
      .lang-btn{
        display:inline-flex; align-items:center; gap:8px; padding:8px 10px; font-weight:800; border-radius:10px;
        border:1px solid #2a333f; background: rgba(14,18,25,.6); color:#d9f6e6; cursor:pointer; font-size:12px
      }
      .lang-btn:hover{ border-color:rgba(35,209,106,.35); box-shadow:0 0 16px rgba(35,209,106,.18) }
      .lang-menu{
        position:absolute; top:110%; right:0; width:210px; background:linear-gradient(180deg, #0f1419, #0c1116);
        border:1px solid rgba(255,255,255,.08); border-radius:12px; box-shadow:0 20px 40px rgba(0,0,0,.45);
        padding:6px; display:none; z-index:70;
      }
      .lang.open .lang-menu{ display:block; animation:menuIn .14s ease-out }
      @keyframes menuIn{ from{ transform:translateY(-6px); opacity:0 } to{ transform:translateY(0); opacity:1 } }
      .lang-item{display:flex; align-items:center; gap:10px; padding:10px 10px; border-radius:10px; cursor:pointer; color:#cfe7dd; font-weight:700;}
      .lang-item:hover{ background:#0b1218; border:1px solid #1d2836 }
      .flag-emoji{
        display:inline-flex; align-items:center; justify-content:center;
        width:18px; height:18px; line-height:18px; font-size:14px; border-radius:3px;
        background:rgba(255,255,255,.06); box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);
      }

      /* ===== HERO (tight) ===== */
      .hero{position:relative; overflow:hidden; border-bottom:1px solid rgba(255,255,255,.06);}
      .hero::before{
        content:""; position:absolute; inset:-10%; background:
          radial-gradient(36rem 26rem at 20% -10%, rgba(22,163,74,.18), transparent 60%),
          radial-gradient(30rem 20rem at 120% 10%, rgba(22,163,74,.10), transparent 60%);
        filter: blur(36px); z-index:0; opacity:.6;
      }
      .hero .container{min-height:64svh; display:flex; align-items:center; position:relative; z-index:1; padding:28px 10px;}
      .badge{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:rgba(22,163,74,.14); border:1px solid rgba(35,209,106,.35); color:#aef2c9; font-weight:800; margin-bottom:12px; font-size:12px}
      .hero h1{font-size:30px; line-height:1.18; margin:0 0 10px; letter-spacing:.2px;}
      .hero p{color:var(--muted); font-size:14px; margin:0 0 18px;}
      .cta{display:flex; gap:10px; flex-wrap:wrap;}

      /* ===== SECTION WRAPPER ===== */
      .section{padding:28px 0; background:linear-gradient(180deg, rgba(12,16,20,.65), rgba(10,12,16,.65)), var(--noise);}
      .section h2{font-size:22px; margin:0 0 10px;}
      .section p.lead{color:#9fb0aa; margin:0 0 16px; font-size:14px;}

      /* ===== “How it works” steps (stacked) ===== */
      .step{display:grid; grid-template-columns:1fr; gap:12px; align-items:start; margin:16px 0 24px;}
      .step h3{font-size:18px; margin:0 0 6px;}
      .step p{margin:0; color:#b4c5bf; font-size:14px}
      .mini{
        border:1px solid rgba(255,255,255,.08); border-radius:14px;
        background:linear-gradient(180deg, #0f1419, #0c1116); box-shadow:var(--shadow-md);
        overflow:hidden; opacity:0; transform:translateY(28px) scale(.98);
        transition:opacity .65s ease, transform .65s cubic-bezier(.2,1,.22,1);
      }
      .mini.in{opacity:1; transform:none;}
      .mini.pop{animation:popIn .7s cubic-bezier(.2,1,.22,1) both;}
      @keyframes popIn{
        0%{opacity:0; transform:translateY(32px) scale(.95)}
        60%{opacity:1; transform:translateY(-3px) scale(1.01)}
        100%{opacity:1; transform:translateY(0) scale(1)}
      }
      .mini .chrome{display:flex; align-items:center; gap:6px; height:32px; padding:0 10px; border-bottom:1px solid rgba(255,255,255,.06); background:rgba(14,18,25,.65);}
      .dot{width:8px; height:8px; border-radius:999px; background:#334050;}
      .dot.red{background:#ff6b6b} .dot.yellow{background:#ffd166} .dot.green{background:#06d6a0}
      .mini .body{padding:12px;}

      .mini .form-row{display:grid; grid-template-columns:1fr; gap:8px; margin-bottom:8px;}
      .mini label{display:block; font-weight:800; font-size:11px; margin:0 0 6px; color:#d0e6dc}
      .mini input{width:100%; padding:10px 12px; border:1px solid #2a333f; border-radius:10px; background:#0b1117; color:#e6f1ee; font-size:13px;}
      .fake-chip{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid #1d2836; background:#0b1218; color:#cde6da; font-size:11px; margin-right:6px;}

      .tag{padding:4px 8px; border-radius:999px; border:1px solid #22303e; background:#0a1117; color:#c7e8d9; font-size:11px; font-weight:700;}

      /* ===== CARDS ===== */
      .card{background:linear-gradient(180deg, #0f1419, #0c1116); border:1px solid rgba(255,255,255,.06); border-radius:16px; box-shadow:var(--shadow-lg); padding:14px;}
      .chips{display:flex; gap:6px; flex-wrap:wrap; margin-top:8px;}
      .chip{padding:6px 10px; border-radius:999px; border:1px solid #22303e; background:#0a1117; color:#c7e8d9; font-size:12px; display:inline-flex; align-items:center; gap:6px;}

      /* ===== HScroll Carousel (no external lib) ===== */
      .rail{
        display:flex; gap:12px; overflow-x:auto; -webkit-overflow-scrolling:touch; scroll-snap-type:x mandatory; padding:6px 2px 4px;
      }
      .rail::-webkit-scrollbar{height:8px} .rail::-webkit-scrollbar-thumb{background:#22303e; border-radius:8px}
      .slide{flex:0 0 82%; max-width:82%; scroll-snap-align:start}
      @media (min-width:420px){ .slide{flex-basis:68%; max-width:68%} }
      @media (min-width:520px){ .slide{flex-basis:56%; max-width:56%} }

      .project-card{display:flex; flex-direction:column; height:100%; overflow:hidden; background:linear-gradient(180deg, #0d1217, #0b0f14); border:1px solid rgba(255,255,255,.06); border-radius:16px; box-shadow:var(--shadow-md);}
      .project-card .thumb{position:relative; height:170px; background:#0b1117; overflow:hidden;}
      .project-card .thumb img{width:100%; height:100%; object-fit:cover; display:block; opacity:.92; transform:scale(1.02)}
      .task-badges{position:absolute; left:10px; bottom:10px; display:flex; gap:6px;}
      .task-badge{padding:6px 10px; border-radius:999px; font-size:11px; font-weight:800; background:rgba(14,18,25,.8); border:1px solid rgba(255,255,255,.08);}
      .task-badge.visit{color:#a0f2bd; border-color:#2a6f47}
      .task-badge.link{color:#b2f5ff; border-color:#2a455e}
      .project-card .body{flex:1; padding:12px; display:flex; flex-direction:column; gap:8px;}
      .project-card h3{font-size:16px; margin:0}
      .project-card p{color:#b7c8c1; font-size:13px; margin:0 0 4px}
      .meta{display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:4px;}
      .meta .pill{background:#0b1218; border:1px solid #1d2836; border-radius:10px; padding:7px 8px; font-size:12px; color:#cde6da; display:flex; align-items:center; gap:6px;}
      .progress{height:8px; background:#0b1218; border:1px solid #1d2836; border-radius:999px; overflow:hidden; margin-top:6px;}
      .progress .bar{height:100%; width:0; background:linear-gradient(90deg,#19b357,#23d16a); box-shadow:var(--glow)}
      .foot{display:flex; justify-content:flex-end; margin-top:auto;}
      .foot .btn{padding:9px 10px; font-size:12px}

      .section-head{display:flex; align-items:center; justify-content:space-between; gap:10px; margin:4px 0 8px;}
      .more-link{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; font-weight:800; border:1px solid rgba(255,255,255,.08); background:rgba(14,18,25,.6); color:#d9f6e6; font-size:12px}
      .more-link:hover{border-color:rgba(35,209,106,.35); box-shadow:0 0 16px rgba(35,209,106,.18)}

      /* Empty states */
      .empty-wrap{padding:14px; border:1px solid rgba(255,255,255,.08); border-radius:14px; background:linear-gradient(180deg,#0f1419,#0c1116); color:#b4c5bf; display:grid; gap:6px;}
      .empty-wrap .msg{font-size:14px}
      .empty-wrap .hint{opacity:.75; font-size:12px}

      /* Reveal animations */
      .reveal{opacity:0; transform:translateY(24px); transition:opacity .55s ease, transform .55s cubic-bezier(.22,.87,.31,1);}
      .reveal.in{opacity:1; transform:none;}
        /* ===== MOBILE HEADER (namespaced .mnav) ===== */
.mnav{position:sticky; top:0; z-index:80; padding-top:env(safe-area-inset-top);
  background:linear-gradient(180deg, rgba(15,17,21,.82), rgba(15,17,21,.52));
  backdrop-filter: blur(12px); border-bottom:1px solid rgba(255,255,255,.06);}
.mnav-bar{display:flex; align-items:center; justify-content:space-between; height:56px; gap:8px;}

.mnav-brand{display:inline-flex; align-items:center; gap:8px; font-weight:800; color:#d8ffe7; text-shadow:0 0 14px rgba(35,209,106,.22);}
.mnav-brand .dot{width:8px;height:8px;border-radius:999px;background:#16a34a;box-shadow:0 0 16px rgba(22,163,74,.42)}
.mnav-brand .name{font-size:16px; letter-spacing:.2px}

.mnav-actions{display:flex; align-items:center; gap:8px;}
.mnav .btn{display:inline-flex; align-items:center; gap:6px; padding:8px 10px; font-weight:800; border-radius:10px; border:1px solid #2fe07a;
  background:linear-gradient(180deg,#19b357,#119e49); color:#05160c; box-shadow:0 0 22px rgba(22,163,74,.25);}
.mnav .pill-addr{max-width:130px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; border:1px solid #2a333f; background:#0b1117;
  color:#d9f6e6; border-radius:999px; padding:6px 10px; font-size:12px; font-weight:700;}

.mnav-toggle{display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:10px;
  border:1px solid #2a333f; background:#0b1117; color:#e6f1ee;}
.mnav-toggle:active{transform:scale(.98)}

/* Sheet */
.mnav-sheet{position:relative; background:linear-gradient(180deg,#0f1419,#0c1116);
  border-top:1px solid rgba(255,255,255,.06); box-shadow:0 30px 60px rgba(0,0,0,.5);
  padding:12px 12px calc(12px + env(safe-area-inset-bottom));}
.mnav-sheet[hidden]{display:none;}
.mnav-list{display:grid; gap:8px; margin:4px 0 10px;}
.mnav-list .item{display:flex; align-items:center; gap:8px; padding:12px 12px; border-radius:12px; font-weight:800;
  border:1px solid #263040; background:rgba(14,18,25,.65); color:#cfe7dd;}
.mnav-list .item:hover{border-color:rgba(35,209,106,.35); box-shadow:0 0 16px rgba(35,209,106,.18)}
.mnav-list .item.active{color:#05160c; border-color:#2fe07a; background:linear-gradient(180deg,#19b357,#119e49); box-shadow:0 0 22px rgba(22,163,74,.25)}
.mnav-list .item.outline{background:#0b1117}

/* Language */
.mnav-lang{margin:2px 0 10px; position:relative;}
.mnav .lang-btn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; font-weight:800; border-radius:12px; border:1px solid #2a333f; background:#0b1117; color:#cfe7dd}
.mnav .flag-emoji{display:inline-flex; align-items:center; justify-content:center; width:18px; height:18px; line-height:18px; font-size:14px; border-radius:3px;
  background:rgba(255,255,255,.06); box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);}
.mnav .lang-menu{position:absolute; top:110%; left:0; min-width:200px; padding:6px; margin:0; list-style:none; display:none; z-index:90;
  background:linear-gradient(180deg,#0f1419,#0c1116); border:1px solid rgba(255,255,255,.08); border-radius:12px; box-shadow:0 20px 40px rgba(0,0,0,.45)}
.mnav .lang.open .lang-menu{display:block; animation:mnavMenuIn .14s ease-out}
@keyframes mnavMenuIn{from{transform:translateY(-6px);opacity:0} to{transform:translateY(0);opacity:1}}
.mnav .lang-item{display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; cursor:pointer; color:#cfe7dd; font-weight:700;}
.mnav .lang-item:hover{ background:#0b1218; border:1px solid #1d2836 }

/* Logout button inside sheet */
.mnav .danger{width:100%; margin-top:6px; padding:11px 12px; border-radius:12px; border:1px solid #3b2020;
  background:linear-gradient(180deg,#6e2c2c,#5a2222); color:#ffeaea; font-weight:800}

/* Ultra-narrow friendliness (Galaxy Fold cover width ~320px) */
@media (max-width:360px){
  .mnav .pill-addr{max-width:98px}
  .mnav-bar{height:52px}
  .mnav-brand .name{font-size:15px}
}

/* Large-fold (unfolded) still uses mobile header but breathes a bit */
@media (min-width:720px){
  .mnav-bar{height:60px}
}
      /* FOOTER */
      .footer{padding:18px 0 24px; border-top:1px solid rgba(255,255,255,.06); color:#a7b9b1; background:#0a0c10; font-size:12px}
        </style>
    </head>
    <body>
        <!-- ===== NAV ===== -->
        <!-- ===== MOBILE HEADER (copy/paste) ===== -->
        <header class="mnav" role="banner">
            <div class="container mnav-bar">
                <a href="{% if meta.lang == 'ko' %}/ko/{% elif meta.lang == 'ja' %}/ja/{% elif meta.lang == 'zh' %}/zh/{% else %}/{% endif %}" class="mnav-brand" aria-label="LinkHash Home">
                    <span class="dot" aria-hidden="true"></span>
                    <span class="name">LinkHash</span>
                </a>
                <div class="mnav-actions">
                    {% if wallet_user %}
                    <span class="pill-addr" title="{{ wallet_user.address }}">👛 {{ wallet_user.address|slice:":6" }}…{{ wallet_user.address|slice:"-4:" }}</span>
                    {% else %}
                    <button class="btn" type="button" onclick="(window.connectWallet||(()=>alert('Wallet script missing')))()">
                        {% if meta.lang == 'ko' %}지갑{% elif meta.lang == 'ja' %}ウォレット{% elif meta.lang == 'zh' %}钱包{% else %}Wallet{% endif %}
                    </button>
                    {% endif %}
                    <button
                        class="mnav-toggle"
                        id="mnavToggle"
                        type="button"
                        aria-controls="mnavSheet"
                        aria-expanded="false"
                        aria-label="Menu"
                    >
                        <svg
                            viewBox="0 0 24 24"
                            width="22"
                            height="22"
                            aria-hidden="true"
                        >
                            <path
                                d="M4 6h16M4 12h16M4 18h16"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                        </svg>
                    </button>
                </div>
            </div>
            <!-- Slide-down sheet -->
            <div class="mnav-sheet" id="mnavSheet" hidden>
                <nav class="mnav-list" aria-label="Primary">
                    <a class="item active" href="{% if meta.lang == 'ko' %}/ko/{% elif meta.lang == 'ja' %}/ja/{% elif meta.lang == 'zh' %}/zh/{% else %}/{% endif %}">
                        🏠 {% if meta.lang == 'ko' %}홈{% elif meta.lang == 'ja' %}ホーム{% elif meta.lang == 'zh' %}主页{% else %}Home{% endif %}
                    </a>
                    <a class="item" href="{% if meta.lang == 'ko' %}/ko/rewards/{% elif meta.lang == 'ja' %}/ja/rewards/{% elif meta.lang == 'zh' %}/zh/rewards/{% else %}/rewards/{% endif %}">
                        🎁 {% if meta.lang == 'ko' %}리워드{% elif meta.lang == 'ja' %}リワード{% elif meta.lang == 'zh' %}奖励{% else %}Rewards{% endif %}
                    </a>
                    <a class="item" href="{% if meta.lang == 'ko' %}/ko/events/{% elif meta.lang == 'ja' %}/ja/events/{% elif meta.lang == 'zh' %}/zh/events/{% else %}/events/{% endif %}">
                        📣 {% if meta.lang == 'ko' %}이벤트{% elif meta.lang == 'ja' %}イベント{% elif meta.lang == 'zh' %}活动{% else %}Events{% endif %}
                    </a>
                    <a class="item" href="{% if meta.lang == 'ko' %}/ko/leaderboard/{% elif meta.lang == 'ja' %}/ja/leaderboard/{% elif meta.lang == 'zh' %}/zh/leaderboard/{% else %}/leaderboard/{% endif %}">
                        🏆 {% if meta.lang == 'ko' %}리더보드{% elif meta.lang == 'ja' %}リーダーボード{% elif meta.lang == 'zh' %}排行榜{% else %}Leaderboard{% endif %}
                    </a>
                    <a class="item outline" href="{% if meta.lang == 'ko' %}/rewards/apply/ko/{% elif meta.lang == 'ja' %}/rewards/apply/ja/{% elif meta.lang == 'zh' %}/rewards/apply/zh/{% else %}/rewards/apply/{% endif %}">
                        📝 {% if meta.lang == 'ko' %}캠페인 신청{% elif meta.lang == 'ja' %}キャンペーン申請{% elif meta.lang == 'zh' %}申请发起活动{% else %}Apply for campaign{% endif %}
                    </a>
                </nav>
                <!-- Language switcher -->
                <div class="mnav-lang" id="langSwitcher" data-current="{{ meta.lang|default:'en' }}">
                    <button
                        class="lang-btn"
                        type="button"
                        aria-haspopup="listbox"
                        aria-expanded="false"
                    >
                        <span class="flag-emoji" aria-hidden="true"></span>
                        <span class="label">
                            {% if meta.lang == 'ko' %}한국어{% elif meta.lang == 'ja' %}日本語{% elif meta.lang == 'zh' %}中文{% else %}English{% endif %}
                        </span>
                        <svg
                            class="chev"
                            viewBox="0 0 20 20"
                            width="14"
                            height="14"
                            aria-hidden="true"
                        >
                            <path
                                d="M5 7l5 6 5-6"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                        </svg>
                    </button>
                    <ul
                        class="lang-menu"
                        role="listbox"
                        tabindex="-1"
                        aria-label="Select language"
                    >
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="en"
                            data-flag="🇺🇸"
                        >🇺🇸 English</li>
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="ko"
                            data-flag="🇰🇷"
                        >🇰🇷 한국어</li>
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="ja"
                            data-flag="🇯🇵"
                        >🇯🇵 日本語</li>
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="zh"
                            data-flag="🇨🇳"
                        >🇨🇳 中文</li>
                    </ul>
                </div>
                {% if wallet_user %}
                <button class="danger" type="button" onclick="(window.logoutWallet||(()=>alert('Wallet script missing')))()">
                    {% if meta.lang == 'ko' %}로그아웃{% elif meta.lang == 'ja' %}ログアウト{% elif meta.lang == 'zh' %}退出{% else %}Logout{% endif %}
                </button>
                {% endif %}
            </div>
        </header>
        <!-- ===== HERO ===== -->
        <section class="hero">
            <div class="container">
                <div class="content">
                    <div class="badge">Web3 · SEO · Rewards</div>
                    <h1>
                        {% if meta.lang == 'ko' %}
              커뮤니티에 보상이 돌아가는
                        <span style="color:#aaf5c7; text-shadow:var(--glow)">투명한 화이트햇</span>
                        캠페인으로 순위를 올리세요.
            {% elif meta.lang == 'ja' %}
              コミュニティに報酬が還元される
                        <span style="color:#aaf5c7; text-shadow:var(--glow)">透明なホワイトハット</span>
                        キャンペーンで順位を伸ばす。
            {% elif meta.lang == 'zh' %}
              通过
                        <span style="color:#aaf5c7; text-shadow:var(--glow)">透明白帽</span>
                        活动提升排名，让奖励回馈社区。
            {% else %}
              Boost rankings with
                        <span style="color:#aaf5c7; text-shadow:var(--glow)">transparent, white-hat</span>
                        campaigns that pay your community.
            {% endif %}
                    </h1>
                    <p>
                        {% if meta.lang == 'ko' %}
              광고주는 USDT로 풀을 펀딩, 사용자는 방문/링크 과제를 수행합니다. 모든 수치가 공개됩니다.
            {% elif meta.lang == 'ja' %}
              広告主はUSDTでプールを資金化、ユーザーはVISIT/LINKタスクを実行。数値はすべて公開。
            {% elif meta.lang == 'zh' %}
              广告主用 USDT 注资奖励池，用户完成访问/外链任务；所有数据公开透明。
            {% else %}
              Advertisers fund pools in USDT. Users complete visit & link-share tasks. Everyone sees the numbers.
            {% endif %}
                    </p>
                    <div class="cta">
                        <a class="btn" href="#projects">
                            {% if meta.lang == 'ko' %}캠페인 보기{% elif meta.lang == 'ja' %}キャンペーンを見る{% elif meta.lang == 'zh' %}查看活动{% else %}Explore Campaigns{% endif %}
                        </a>
                        <a class="btn-outline" href="{% if meta.lang == 'ko' %}/rewards/apply/ko/{% elif meta.lang == 'ja' %}/rewards/apply/ja/{% elif meta.lang == 'zh' %}/rewards/apply/zh/{% else %}/rewards/apply/{% endif %}">
                            {% if meta.lang == 'ko' %}캠페인 신청{% elif meta.lang == 'ja' %}申請{% elif meta.lang == 'zh' %}发起{% else %}Apply{% endif %}
                        </a>
                    </div>
                </div>
            </div>
        </section>
        <!-- ===== HOW IT WORKS ===== -->
        <section class="section">
            <div class="container">
                <!-- Step 1 -->
                <div class="step">
                    <div class="reveal">
                        <h3>1) {% if meta.lang == 'ko' %}클라이언트가 USDT 풀을 펀딩{% elif meta.lang == 'ja' %}クライアントがUSDTプールに資金投入{% elif meta.lang == 'zh' %}客户注资 USDT 奖励池{% else %}Client funds a USDT pool{% endif %}</h3>
                        <p>
                            {% if meta.lang == 'ko' %}
                예산과 기간을 선택하면 명확한 규칙(VISIT/LINK, 허용 링크, 가이드)을 공개합니다.
              {% elif meta.lang == 'ja' %}
                予算と期間を選び、明確なルールを公開します。
              {% elif meta.lang == 'zh' %}
                选择预算与周期，公开清晰规则。
              {% else %}
                Choose budget & dates. We publish clear rules and show the live pool size.
              {% endif %}
                        </p>
                    </div>
                    <div class="mini">
                        <div class="chrome">
                            <span class="dot red"></span>
                            <span class="dot yellow"></span>
                            <span class="dot green"></span>
                        </div>
                        <div class="body">
                            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
                                <strong style="font-size:14px">{% if meta.lang == 'ko' %}캠페인 런칭 신청{% elif meta.lang == 'ja' %}キャンペーン申請{% elif meta.lang == 'zh' %}发起活动申请{% else %}Request a New Campaign{% endif %}</strong>
                                <div>
                                    <span class="fake-chip">Web3</span>
                                    <span class="fake-chip">SEO</span>
                                    <span class="fake-chip">{% if meta.lang == 'ko' %}화이트햇{% elif meta.lang == 'ja' %}ホワイトハット{% elif meta.lang == 'zh' %}白帽{% else %}White-hat{% endif %}</span>
                                </div>
                            </div>
                            <div class="form-row">
                                <div>
                                    <label>Email *</label>
                                    <input placeholder="name@example.com" disabled>
                                </div>
                                <div>
                                    <label>{% if meta.lang == 'ko' %}전화번호{% elif meta.lang == 'ja' %}電話番号{% elif meta.lang == 'zh' %}电话{% else %}Phone{% endif %} *</label>
                                    <input placeholder="+82 10 1234 1234" disabled>
                                </div>
                            </div>
                            <div class="form-row">
                                <div>
                                    <label>{% if meta.lang == 'ko' %}캠페인 제목{% elif meta.lang == 'ja' %}キャンペーン名{% elif meta.lang == 'zh' %}活动标题{% else %}Campaign Title{% endif %}</label>
                                    <input placeholder="SimpleQuant Blog Launch" disabled>
                                </div>
                                <div>
                                    <label>URL</label>
                                    <input placeholder="https://example.com" disabled>
                                </div>
                            </div>
                            <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:6px;">
                                <button class="btn" onclick="location.href='{% if meta.lang == 'ko' %}/rewards/apply/ko/{% elif meta.lang == 'ja' %}/rewards/apply/ja/{% elif meta.lang == 'zh' %}/rewards/apply/zh/{% else %}/rewards/apply/{% endif %}'">
                                    {% if meta.lang == 'ko' %}신청하기{% elif meta.lang == 'ja' %}申請する{% elif meta.lang == 'zh' %}去申请{% else %}Apply now{% endif %}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Step 2 -->
                <div class="step">
                    <div class="reveal">
                        <h3>2) {% if meta.lang == 'ko' %}과제가 공개되고 검증{% elif meta.lang == 'ja' %}タスク公開と検証{% elif meta.lang == 'zh' %}任务上线并验证{% else %}Tasks go live & are verified{% endif %}</h3>
                        <p>
                            {% if meta.lang == 'ko' %}
                참여자는
                            <b>VISIT</b>
                            또는
                            <b>LINK</b>
                            미션을 선택합니다. 안티 스팸 + 리뷰로 화이트햇 유지.
              {% elif meta.lang == 'ja' %}
                参加者は
                            <b>VISIT</b>
                            または
                            <b>LINK</b>
                            を選択。スパム対策と審査で健全運用。
              {% elif meta.lang == 'zh' %}
                参与者选择
                            <b>VISIT</b>
                            或
                            <b>LINK</b>
                            。反垃圾与审核保障白帽。
              {% else %}
                Users pick
                            <b>VISIT</b>
                            or
                            <b>LINK</b>
                            . Anti-spam & review keep it white-hat.
              {% endif %}
                        </p>
                    </div>
                    <div class="mini">
                        <div class="chrome">
                            <span class="dot red"></span>
                            <span class="dot yellow"></span>
                            <span class="dot green"></span>
                        </div>
                        <div class="body">
                            <strong style="font-size:14px; display:block; margin-bottom:8px;">
                                {% if meta.lang == 'ko' %}캠페인 목록{% elif meta.lang == 'ja' %}キャンペーン一覧{% elif meta.lang == 'zh' %}活动列表{% else %}Campaigns{% endif %}
                            </strong>
                            <div style="display:flex; gap:6px; flex-wrap:wrap; margin-bottom:8px;">
                                <span class="tag">VISIT</span>
                                <span class="tag">LINK</span>
                                <span class="tag">{% if meta.lang == 'ko' %}즉시{% elif meta.lang == 'ja' %}即時{% elif meta.lang == 'zh' %}即时{% else %}Instant{% endif %}</span>
                            </div>
                            <div class="empty-wrap" role="note">
                                <div class="msg" style="display:flex; align-items:center; gap:8px;">
                                    <span>✨</span>
                                    <span>{% if meta.lang == 'ko' %}실제 캠페인은 아래에서 확인하세요.{% elif meta.lang == 'ja' %}実際のキャンペーンは下で確認。{% elif meta.lang == 'zh' %}真实活动见下。{% else %}See live campaigns below.{% endif %}</span>
                                </div>
                            </div>
                            <div style="display:flex; justify-content:flex-end; margin-top:8px;">
                                <button class="btn" onclick="location.href='{% if meta.lang == 'ko' %}/ko/rewards/{% elif meta.lang == 'ja' %}/ja/rewards/{% elif meta.lang == 'zh' %}/zh/rewards/{% else %}/rewards/{% endif %}'">
                                    {% if meta.lang == 'ko' %}캠페인 더 보기{% elif meta.lang == 'ja' %}もっと見る{% elif meta.lang == 'zh' %}查看更多{% else %}Browse campaigns{% endif %}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Step 3 -->
                <div class="step">
                    <div class="reveal">
                        <h3>3) {% if meta.lang == 'ko' %}검증 후 즉시 보상{% elif meta.lang == 'ja' %}検証後すぐに報酬{% elif meta.lang == 'zh' %}验证通过即刻发放{% else %}Rewards claimed instantly{% endif %}</h3>
                        <p>
                            {% if meta.lang == 'ko' %}
                승인된 액션마다 USDT가 지급됩니다. 진행 현황은 모두 공개.
              {% elif meta.lang == 'ja' %}
                承認ごとにUSDT支払い。進捗は公開。
              {% elif meta.lang == 'zh' %}
                每次通过即付 USDT。进度公开。
              {% else %}
                Each approved action pays from the pool. Progress is public.
              {% endif %}
                        </p>
                    </div>
                    <div class="mini">
                        <div class="chrome">
                            <span class="dot red"></span>
                            <span class="dot yellow"></span>
                            <span class="dot green"></span>
                        </div>
                        <div class="body">
                            <h4 style="margin:0 0 6px;">SimpleQuant: Blog launch</h4>
                            <p style="margin:0 0 8px; color:#9fb0aa">{% if meta.lang == 'ko' %}코드 제출로 보상{% elif meta.lang == 'ja' %}コード提出で報酬{% elif meta.lang == 'zh' %}提交代码领奖{% else %}Submit code to earn{% endif %}</p>
                            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                <span class="chip">
                                    <strong>{% if meta.lang == 'ko' %}풀{% elif meta.lang == 'ja' %}プール{% elif meta.lang == 'zh' %}奖励池{% else %}Pool{% endif %}</strong>
                                    &nbsp;2,000 USDT
                                </span>
                                <span class="chip">
                                    <strong>{% if meta.lang == 'ko' %}참여자{% elif meta.lang == 'ja' %}人数{% elif meta.lang == 'zh' %}参与者{% else %}People{% endif %}</strong>
                                    &nbsp;842
                                </span>
                            </div>
                            <div class="progress" style="margin-top:6px;">
                                <div class="bar" style="width:63%"></div>
                            </div>
                            <div style="display:flex; justify-content:space-between; font-size:12px; color:#9fb0aa; margin-top:6px;">
                                <span>63% {% if meta.lang == 'ko' %}클레임{% elif meta.lang == 'ja' %}達成{% elif meta.lang == 'zh' %}已领取{% else %}claimed{% endif %}</span>
                                <span>2025-09-01 → 2025-10-31</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- ===== LIVE CAMPAIGNS ===== -->
        <section id="projects" class="section" style="padding-top:10px;">
            <div class="container">
                <div class="section-head">
                    <h2>{% if meta.lang == 'ko' %}진행 중 캠페인{% elif meta.lang == 'ja' %}開催中のキャンペーン{% elif meta.lang == 'zh' %}进行中的活动{% else %}Live Campaigns{% endif %}</h2>
                    <a class="more-link" href="{% if meta.lang == 'ko' %}/ko/rewards/{% elif meta.lang == 'ja' %}/ja/rewards/{% elif meta.lang == 'zh' %}/zh/rewards/{% else %}/rewards/{% endif %}">
                        {% if meta.lang == 'ko' %}더 보기{% elif meta.lang == 'ja' %}もっと見る{% elif meta.lang == 'zh' %}查看更多{% else %}View more{% endif %}
                        <span aria-hidden="true">→</span>
                    </a>
                </div>
                <p class="lead">
                    {% if meta.lang == 'ko' %}가게 구경하듯 과제를 탐색하세요 — 미션 선택, 완료, 보상 수령.{% elif meta.lang == 'ja' %}ショップ感覚でタスクを選んで、こなして、受け取る。{% elif meta.lang == 'zh' %}像逛商店一样选任务、做任务、领奖励。{% else %}Browse tasks like a shop — pick a mission, complete it, claim rewards.{% endif %}
                </p>
                {% if projects and projects|length > 0 %}
                <div class="rail" aria-label="Live campaigns">
                    {% for c in projects %}
                    <div class="slide">
                        <article class="project-card">
                            <div class="thumb">
                                <img src="{{ c.image_url|default:'' }}" onerror="this.src='{% static 'img/cards/green-office.jpg' %}'" alt="">
                                <div class="task-badges">
                                    {% if c.has_visit %}
                                    <span class="task-badge visit">VISIT</span>
                                    {% endif %}
                  {% if c.has_link %}
                                    <span class="task-badge link">LINK</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="body">
                                <h3>{{ c.title }}</h3>
                                <p>{{ c.summary }}</p>
                                <div class="meta">
                                    <div class="pill">
                                        <strong>{% if meta.lang == 'ko' %}풀{% elif meta.lang == 'ja' %}プール{% elif meta.lang == 'zh' %}奖励池{% else %}Pool{% endif %}</strong>
                                        &nbsp; {{ c.pool_usdt }} USDT
                                    </div>
                                    <div class="pill">
                                        <strong>{% if meta.lang == 'ko' %}참여자{% elif meta.lang == 'ja' %}人数{% elif meta.lang == 'zh' %}参与者{% else %}People{% endif %}</strong>
                                        &nbsp; {{ c.participants }}
                                    </div>
                                </div>
                                <div class="progress">
                                    <div class="bar" data-pct="{{ c.claimed_percent|default:0 }}"></div>
                                </div>
                                <div style="display:flex; justify-content:space-between; font-size:12px; color:#9fb0aa;">
                                    <span>{{ c.claimed_percent|default:0 }}% {% if meta.lang == 'ko' %}클레임{% elif meta.lang == 'ja' %}達成{% elif meta.lang == 'zh' %}已领取{% else %}claimed{% endif %}</span>
                                    <span>{{ c.start|date:"Y-m-d" }} → {{ c.end|date:"Y-m-d" }}</span>
                                </div>
                                <div class="foot">
                                    <a class="btn" href="/rewards/{{ c.slug }}-{{ c.id }}/">{% if meta.lang == 'ko' %}자세히{% elif meta.lang == 'ja' %}詳細{% elif meta.lang == 'zh' %}详情{% else %}Details{% endif %}</a>
                                </div>
                            </div>
                        </article>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-wrap" role="status" aria-live="polite">
                    <div class="msg">
                        {% if meta.lang == 'ko' %}현재 진행 중인 캠페인이 없습니다.{% elif meta.lang == 'ja' %}現在、開催中のキャンペーンはありません。{% elif meta.lang == 'zh' %}目前没有进行中的活动。{% else %}No live campaigns yet.{% endif %}
                    </div>
                    <div class="hint">
                        {% if meta.lang == 'ko' %}새 캠페인이 곧 열립니다. 나중에 다시 확인하거나 알림을 구독하세요.{% elif meta.lang == 'ja' %}まもなく開始予定。後で再度ご確認ください。{% elif meta.lang == 'zh' %}新的活动即将上线，请稍后再来查看。{% else %}New campaigns launch soon — check back shortly.{% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
        </section>
        <!-- ===== PAST CAMPAIGNS ===== -->
        <section id="past-projects" class="section" style="padding-top:10px;">
            <div class="container">
                <div class="section-head">
                    <h2>{% if meta.lang == 'ko' %}지난 캠페인{% elif meta.lang == 'ja' %}過去のキャンペーン{% elif meta.lang == 'zh' %}以往活动{% else %}Past Campaigns{% endif %}</h2>
                    <a class="more-link" href="{% if meta.lang == 'ko' %}/ko/rewards/{% elif meta.lang == 'ja' %}/ja/rewards/{% elif meta.lang == 'zh' %}/zh/rewards/{% else %}/rewards/{% endif %}">
                        {% if meta.lang == 'ko' %}전체 보기{% elif meta.lang == 'ja' %}すべて見る{% elif meta.lang == 'zh' %}全部浏览{% else %}Browse all{% endif %}
                        <span aria-hidden="true">→</span>
                    </a>
                </div>
                <p class="lead">
                    {% if meta.lang == 'ko' %}공개된 지표로 운영 결과를 확인하세요 — 좋은 캠페인의 사례입니다.{% elif meta.lang == 'ja' %}公開メトリクスで成果を確認。良い事例をチェック。{% elif meta.lang == 'zh' %}通过公开指标查看成效——优秀活动的样板。{% else %}Closed pools with public metrics — see what a good campaign looks like.{% endif %}
                </p>
                {% if past_projects and past_projects|length > 0 %}
                <div class="rail" aria-label="Past campaigns">
                    {% for c in past_projects %}
                    <div class="slide">
                        <article class="project-card">
                            <div class="thumb">
                                <img src="{{ c.image_url|default:'' }}" onerror="this.src='{% static 'img/cards/neon-city.jpg' %}'" alt="">
                                <div class="task-badges">
                                    {% if c.has_link %}
                                    <span class="task-badge link">LINK</span>
                                    {% endif %}
                  {% if c.has_visit %}
                                    <span class="task-badge visit">VISIT</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="body">
                                <h3>{{ c.title }}</h3>
                                <p>{{ c.summary }}</p>
                                <div class="meta">
                                    <div class="pill">
                                        <strong>{% if meta.lang == 'ko' %}풀{% elif meta.lang == 'ja' %}プール{% elif meta.lang == 'zh' %}奖励池{% else %}Pool{% endif %}</strong>
                                        &nbsp; {{ c.pool_usdt }} USDT
                                    </div>
                                    <div class="pill">
                                        <strong>{% if meta.lang == 'ko' %}참여자{% elif meta.lang == 'ja' %}人数{% elif meta.lang == 'zh' %}参与者{% else %}People{% endif %}</strong>
                                        &nbsp; {{ c.participants }}
                                    </div>
                                </div>
                                <div class="progress">
                                    <div class="bar" data-pct="{{ c.claimed_percent|default:100 }}"></div>
                                </div>
                                <div style="display:flex; justify-content:space-between; font-size:12px; color:#9fb0aa;">
                                    <span>{{ c.claimed_percent|default:100 }}% {% if meta.lang == 'ko' %}클레임{% elif meta.lang == 'ja' %}達成{% elif meta.lang == 'zh' %}已领取{% else %}claimed{% endif %}</span>
                                    <span>{{ c.start|date:"Y-m-d" }} → {{ c.end|date:"Y-m-d" }}</span>
                                </div>
                                <div class="foot">
                                    <a class="btn" href="/rewards/{{ c.slug }}-{{ c.id }}/">{% if meta.lang == 'ko' %}요약{% elif meta.lang == 'ja' %}サマリー{% elif meta.lang == 'zh' %}总结{% else %}Summary{% endif %}</a>
                                </div>
                            </div>
                        </article>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-wrap" role="status" aria-live="polite">
                    <div class="msg">
                        {% if meta.lang == 'ko' %}아직 지난 캠페인 기록이 없습니다.{% elif meta.lang == 'ja' %}過去のキャンペーンはまだありません。{% elif meta.lang == 'zh' %}暂无以往活动记录。{% else %}No past campaigns yet.{% endif %}
                    </div>
                    <div class="hint">
                        {% if meta.lang == 'ko' %}첫 캠페인이 종료되면 여기에서 요약을 볼 수 있어요.{% elif meta.lang == 'ja' %}最初のキャンペーンが終了すると、ここに概要が表示されます。{% elif meta.lang == 'zh' %}首个活动结束后，这里会显示总结。{% else %}Once your first campaign closes, summaries will appear here.{% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
        </section>
        <!-- ===== FOOTER ===== -->
        <footer class="footer">
            <div class="container" style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <div>
                    ©
                    <strong>LinkHash</strong>
                </div>
                <div style="opacity:.7">
                    {% if meta.lang == 'ko' %}화이트햇 백링크 · 투명한 리워드{% elif meta.lang == 'ja' %}ホワイトハット被リンク・透明な報酬{% elif meta.lang == 'zh' %}白帽外链 · 透明奖励{% else %}White-hat backlinks · Transparent rewards{% endif %}
                </div>
            </div>
        </footer>
        <!-- ===== JS: progress/reveal + wallet + language ===== -->
    </body>
    <!-- 1) Load the WalletConnect UMD from your own static path (no async/defer) -->
    <!-- 0) Try to load the WalletConnect provider UMD (self-hosted) -->
    <script src="/static/js/ethereum-provider.umd.min.js"></script>
    <!-- 1) Progress / reveal helpers (unchanged) -->
    <script>
// Progress bars (animate when visible)
const barsObserver = new IntersectionObserver((entries)=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      const b = e.target;
      const target = (b.dataset.pct ? b.dataset.pct : b.style.width || '0').toString().replace('%','');
      b.style.transition = 'width 900ms cubic-bezier(.2,1,.22,1)';
      requestAnimationFrame(()=> b.style.width = (target ? target : '0') + '%');
      barsObserver.unobserve(b);
    }
  });
},{ threshold:.3 });
document.querySelectorAll('.progress .bar').forEach(el=>barsObserver.observe(el));

// Reveal animations
const revealObserver = new IntersectionObserver((entries)=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){
      entry.target.classList.add('in');
      if(entry.target.classList.contains('mini')){
        entry.target.classList.add('pop');
        entry.target.querySelectorAll('.progress .bar').forEach(b=>{
          const w = b.style.width || '60%';
          b.style.width = '0%';
          b.style.transition = 'width 900ms cubic-bezier(.2,1,.22,1) 120ms';
          requestAnimationFrame(()=> b.style.width = w);
        });
      }
      revealObserver.unobserve(entry.target);
    }
  });
},{ threshold:.25 });
document.querySelectorAll('.reveal, .mini').forEach(el=>revealObserver.observe(el));
    </script>
    <!-- 2) WalletConnect loader: UMD global first, then ESM import fallback -->
    <script>
const WC_SOURCES = {
  umdSelf: "/static/js/ethereum-provider.umd.min.js",
  esmSelf: "/static/js/ethereum-provider.esm.min.js",
  umdCdn: [
    "https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.11.2/dist/index.umd.min.js",
    "https://unpkg.com/@walletconnect/ethereum-provider@2.11.2/dist/index.umd.min.js",
    "https://cdn.walletconnect.com/ethereum-provider@2.11.2/index.umd.min.js"
  ],
  esmCdn: "https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.11.2/dist/index.min.js"
};

function hasEP(){
  const g = (globalThis || window);
  return !!(g.EthereumProvider && typeof g.EthereumProvider.init === 'function')
      || !!(g.WalletConnectEthereumProvider && typeof g.WalletConnectEthereumProvider.init === 'function')
      || !!(g.WalletConnectProvider && (
            (g.WalletConnectProvider.default && typeof g.WalletConnectProvider.default.init === 'function') ||
            (g.WalletConnectProvider.EthereumProvider && typeof g.WalletConnectProvider.EthereumProvider.init === 'function')
         ));
}

function pickEP(){
  const g = (globalThis || window);
  if (g.EthereumProvider && typeof g.EthereumProvider.init === 'function') return g.EthereumProvider;
  if (g.WalletConnectEthereumProvider && typeof g.WalletConnectEthereumProvider.init === 'function') return g.WalletConnectEthereumProvider;
  if (g.WalletConnectProvider){
    if (g.WalletConnectProvider.default && typeof g.WalletConnectProvider.default.init === 'function') return g.WalletConnectProvider.default;
    if (g.WalletConnectProvider.EthereumProvider && typeof g.WalletConnectProvider.EthereumProvider.init === 'function') return g.WalletConnectProvider.EthereumProvider;
  }
  return null;
}

function loadTag(src){
  return new Promise((resolve, reject)=>{
    if (document.querySelector(`script[data-wc="${src}"]`)) return resolve();
    const s = document.createElement('script');
    s.src = src;
    s.setAttribute('data-wc', src);
    s.onload  = ()=> resolve();
    s.onerror = ()=> reject(new Error('Failed to load '+src));
    document.head.appendChild(s);
  });
}

async function tryUMDFallbacks(){
  // We already included /static/js/... at the very top. If no global, try public UMDs.
  for (const url of WC_SOURCES.umdCdn){
    try { await loadTag(url); if (hasEP()) return true; } catch(e){}
  }
  return false;
}

async function tryESMImport(path){
  try{
    const mod = await import(path);
    // Both jsDelivr ESM and the package export { EthereumProvider }
    const EP = mod?.EthereumProvider || mod?.default?.EthereumProvider || mod?.default;
    if (EP && typeof EP.init === 'function'){
      // Normalize: expose as window.EthereumProvider for the rest of our code
      window.EthereumProvider = EP;
      return true;
    }
  }catch(e){}
  return false;
}

/** Ensure a usable EthereumProvider constructor is available one way or another. */
async function ensureEthereumProviderConstructor(){
  // 1) Did the self-hosted UMD already attach a global?
  if (hasEP()) return pickEP();

  // 2) Try ESM from self-host (if you placed it there)
  if (await tryESMImport(WC_SOURCES.esmSelf)) return pickEP();

  // 3) Try UMD from public CDNs
  if (await tryUMDFallbacks()) return pickEP();

  // 4) Try ESM from CDN and normalize to global
  if (await tryESMImport(WC_SOURCES.esmCdn)) return pickEP();

  // 5) Give up with a diagnostic
  const seen = Object.keys(window).filter(k=>/EthereumProvider|WalletConnect/.test(k)).join(', ') || '(none)';
  throw new Error(
    [
      'WalletConnect provider script present but no global/module found.',
      'Quick checks:',
      '• Keep <script src="/static/js/ethereum-provider.umd.min.js"></' + 'script> BEFORE this block.',
      "• Optionally self-host the ESM at /static/js/ethereum-provider.esm.min.js (see note).",
      '• CSP SCRIPT-SRC must include self (so /static is allowed).',
      '• Try a private window (content blockers).',
      '• HTTPS origin + your domain allowlisted in Reown.',
      'Seen window keys: ' + seen
    ].join('\n')
  );
}
    </script>
    <!-- 3) App logic: init provider + connect/logout -->
    <script>
const WC_PROJECT_ID   = 'c1a3ea2d1e5c23e1f3abb31b0d7dc565';
const PRIMARY_CHAIN   = 1;
const OPTIONAL_CHAINS = [137, 42161, 8453, 10];

let wcProvider = null;
let _isConnecting = false;

// Minimal fetch helpers
async function apiGet(url){
  const res  = await fetch(url, { credentials:'include' });
  const data = await res.json().catch(()=> ({}));
  return { ok: res.ok, ...data };
}
async function apiPost(url, body){
  const res  = await fetch(url, {
    method:'POST',
    credentials:'include',
    headers:{ 'Content-Type':'application/json', 'X-Requested-With':'fetch' },
    body: JSON.stringify(body || {})
  });
  const data = await res.json().catch(()=> ({}));
  return { ok: res.ok, ...data };
}

async function ensureProvider(){
  if (wcProvider) return wcProvider;

  const EP = await ensureEthereumProviderConstructor(); // from loader block above
  wcProvider = await EP.init({
    projectId: WC_PROJECT_ID,
    chains: [PRIMARY_CHAIN],
    optionalChains: OPTIONAL_CHAINS,
    methods: ['eth_requestAccounts','personal_sign'],
    events: ['accountsChanged','chainChanged','disconnect'],
    showQrModal: true,
    qrModalOptions: { themeMode: 'dark' },
    metadata: {
      name: 'LinkHash',
      description: 'Web3 SEO Rewards',
      url: window.location.origin,
      icons: ['https://favicone.com/linkhash.png']
    }
  });

  wcProvider.on?.('disconnect', ()=>{ /* no-op */ });
  return wcProvider;
}

async function connectWallet(){
  if (_isConnecting) return;
  _isConnecting = true;

  const btn  = document.querySelector('.mnav .btn:not(.danger)');
  const prev = btn ? btn.textContent : '';
  if (btn) { btn.disabled = true; btn.textContent = 'Connecting…'; }

  try{
    const provider = await ensureProvider();

    if (!provider.session) await provider.connect();

    const accounts = await provider.request({ method:'eth_requestAccounts' });
    const address  = accounts && accounts[0];
    if (!address) throw new Error('No account selected');

    const nonceRes = await apiGet(`/api/auth/nonce?address=${encodeURIComponent(address)}`);
    if (!nonceRes.ok) throw new Error(nonceRes.error || 'Nonce fetch failed');
    const message = nonceRes.message || `LinkHash login\n\nNonce: ${nonceRes.nonce}`;

    let signature;
    try{
      signature = await provider.request({ method:'personal_sign', params:[message, address] });
    }catch(e1){
      try{
        signature = await provider.request({ method:'personal_sign', params:[address, message] });
      }catch(e2){
        const hexMsg = '0x' + Array.from(new TextEncoder().encode(message))
          .map(b=>b.toString(16).padStart(2,'0')).join('');
        signature = await provider.request({ method:'personal_sign', params:[hexMsg, address] });
      }
    }

    const verifyRes = await apiPost('/api/auth/verify', { address, signature, message });
    if (verifyRes && verifyRes.ok){ window.location.reload(); return; }
    throw new Error('Verify failed');
  }catch(err){
    console.error(err);
    alert('Wallet login failed: ' + (err?.message || err));
  }finally{
    if (btn) { btn.disabled = false; btn.textContent = prev; }
    _isConnecting = false;
  }
}

async function logoutWallet(){
  try{
    if (wcProvider?.disconnect) await wcProvider.disconnect();
    await apiPost('/api/auth/logout', {});
    window.location.reload();
  }catch(err){
    console.error(err);
    alert('Logout failed: ' + (err?.message || err));
  }
}

window.connectWallet = connectWallet;
window.logoutWallet  = logoutWallet;
    </script>
    <!-- 4) Mobile header (sheet + language switcher) -->
    <script>
(function(){
  // Sheet toggle
  const $toggle = document.getElementById('mnavToggle');
  const $sheet  = document.getElementById('mnavSheet');
  if($toggle && $sheet){
    const open = ()=>{ $sheet.hidden = false; $toggle.setAttribute('aria-expanded','true'); document.documentElement.style.overflow='hidden'; };
    const close= ()=>{ $sheet.hidden = true;  $toggle.setAttribute('aria-expanded','false'); document.documentElement.style.overflow=''; };
    $toggle.addEventListener('click', ()=> $sheet.hidden ? open() : close());
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') close(); });

    // Close sheet on outside click (only when open)
    document.addEventListener('click', (e)=>{
      if($sheet.hidden) return;
      const within = e.target.closest('#mnavSheet') || e.target.closest('#mnavToggle');
      if(!within) close();
    });
  }

  // Language switcher (same routing rules as desktop)
  const $wrap = document.getElementById('langSwitcher');
  if($wrap){
    const $btn  = $wrap.querySelector('.lang-btn');
    const $menu = $wrap.querySelector('.lang-menu');
    const current = ($wrap.dataset.current || 'en').toLowerCase();
    const flagEl = $btn.querySelector('.flag-emoji');
    const labelEl= $btn.querySelector('.label');
    const flagMap= { en:'🇺🇸', ko:'🇰🇷', ja:'🇯🇵', zh:'🇨🇳' };
    flagEl.textContent = flagMap[current] || '🇺🇸';

    function closeMenu(){ $wrap.classList.remove('open'); $btn.setAttribute('aria-expanded','false'); }
    function openMenu(){  $wrap.classList.add('open');    $btn.setAttribute('aria-expanded','true');  }

    $btn.addEventListener('click', (e)=>{ e.stopPropagation(); $wrap.classList.contains('open') ? closeMenu() : openMenu(); });
    document.addEventListener('click', closeMenu);
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeMenu(); });

    function pathFor(lang){
      const loc = window.location;
      const path = loc.pathname;
      const clean = path.replace(/^\/(ko|ja|zh)(\/|$)/, '/'); // strip locale prefix
      const baseMap = { '/': true, '/rewards/': true, '/events/': true, '/leaderboard/': true };
      const isApply = /^\/rewards\/apply(\/(ko|ja|zh)\/)?$/.test(path);
      if(isApply){
        if(lang === 'en') return '/rewards/apply/?lang=en';
        return `/rewards/apply/${lang}/`;
      }
      if(baseMap[clean]){
        if(lang === 'en'){
          const q = new URLSearchParams(loc.search);
          q.set('lang','en');
          return clean + (q.toString() ? `?${q.toString()}` : '');
        }
        return clean === '/' ? `/${lang}/` : `/${lang}${clean}`;
      }
      const params = new URLSearchParams(loc.search);
      params.set('lang', lang);
      return path + (params.toString() ? `?${params.toString()}` : '');
    }

    $menu.querySelectorAll('.lang-item').forEach(li=>{
      li.addEventListener('click', ()=>{
        const lang  = li.getAttribute('data-lang');
        const emoji = li.getAttribute('data-flag') || '';
        flagEl.textContent = emoji;
        labelEl.textContent = lang==='ko' ? '한국어' : lang==='ja' ? '日本語' : lang==='zh' ? '中文' : 'English';
        closeMenu();
        const target = pathFor(lang);
        if(target) window.location.href = target;
      });
    });
  }
})();
    </script>
</html>
