<!doctype html>
{% load static %}
<html lang="{{ meta.lang|default:'en' }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ meta.title }}</title>
  <link rel="canonical" href="{{ meta.canonical }}">
  <meta name="robots" content="index,follow">
  <meta name="author" content="LinkHash">
  <meta name="description" content="{{ meta.description|default:'Events & announcements' }}">
  <!-- OG -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="LinkHash">
  <meta property="og:title" content="{{ meta.og_title }}">
  <meta property="og:description" content="{{ meta.og_description }}">
  <meta property="og:url" content="{{ meta.url }}">
  <meta property="og:image" content="{% static 'img/og-cover.png' %}">
  <!-- Favicons -->
  <link rel="icon" href="{% static 'img/favicon.ico' %}">
  <style>
    :root{
      --bg:#0a0b0d; --bg-elev:#0f1115; --panel:#11141a; --panel-2:#0e1318; --grid:#0b0f13; --line:#1a212d;
      --text:#e6f1ee; --muted:#9fb0aa; --green:#16a34a; --green-2:#23d16a; --radius:16px;
      --glow:0 0 22px rgba(22,163,74,.35), 0 0 48px rgba(22,163,74,.15);
      --shadow-lg:0 40px 80px rgba(0,0,0,.55), inset 0 -1px 0 rgba(255,255,255,.03);
      --shadow-md:0 16px 40px rgba(0,0,0,.45);
      --noise:transparent url('data:image/svg+xml;utf8,\
        <svg xmlns="http://www.w3.org/2000/svg" width=\"120\" height=\"120\" viewBox=\"0 0 120 120\">\
        <filter id=\"n\"><feTurbulence type=\"fractalNoise\" baseFrequency=\"0.9\" numOctaves=\"2\" stitchTiles=\"stitch\"/></filter>\
        <rect width=\"120\" height=\"120\" filter=\"url(%23n)\" opacity=\".04\"/></svg>') repeat;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      background:
        radial-gradient(80rem 60rem at 90% -10%, rgba(22,163,74,.12), transparent 60%),
        radial-gradient(60rem 40rem at -20% 20%, rgba(35,209,106,.08), transparent 60%),
        linear-gradient(180deg, #08090b, #0a0b0d 20%, #090c10);
      font-family: ui-sans-serif, Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
      letter-spacing:.2px; background-attachment: fixed;
    }
    a{color:inherit;text-decoration:none}
    .container{width:1200px; margin:0 auto; padding:0 20px;}

    .nav{position:sticky; top:0; z-index:60; backdrop-filter: blur(10px);
      background:linear-gradient(180deg, rgba(15,17,21,.65), rgba(15,17,21,.35));
      border-bottom:1px solid rgba(255,255,255,.06);}
    .nav .row{display:flex; align-items:center; justify-content:space-between; height:72px;}
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.4px; color:#d8ffe7; text-shadow:0 0 18px rgba(35,209,106,.24)}
    .brand .dot{width:10px;height:10px;border-radius:999px;background:var(--green);box-shadow:var(--glow)}
    .links{display:flex; gap:24px; align-items:center;}
    .links a{color:#cfe7dd; opacity:.9}
    .links a:hover{color:#fff; text-shadow:0 0 12px rgba(35,209,106,.25)}
    .btn{display:inline-flex; align-items:center; gap:10px; padding:12px 16px; font-weight:700; border-radius:12px; background:linear-gradient(180deg,#19b357,#119e49); color:#05160c; box-shadow:var(--glow); border:1px solid #2fe07a}
    .btn-outline{padding:10px 14px; border-radius:12px; border:1px solid #2a333f; background: rgba(14,18,25,.6); color:#d9f6e6}

    .lang{ position:relative; margin-left:8px; display:flex; gap:10px; align-items:center; }
    .lang-btn{display:inline-flex; align-items:center; gap:10px; padding:10px 12px; font-weight:700; border-radius:12px; border:1px solid #2a333f; background: rgba(14,18,25,.6); color:#d9f6e6; cursor:pointer;}
    .lang-btn:hover{ border-color:rgba(35,209,106,.35); box-shadow:0 0 16px rgba(35,209,106,.18) }
    .lang .chev{ opacity:.8 }
    .lang-menu{position:absolute; top:110%; right:0; width:210px; background:linear-gradient(180deg, #0f1419, #0c1116); border:1px solid rgba(255,255,255,.08); border-radius:12px; box-shadow:0 20px 40px rgba(0,0,0,.45); padding:6px; display:none; z-index:70;}
    .lang.open .lang-menu{ display:block; animation:menuIn .14s ease-out }
    @keyframes menuIn{ from{ transform:translateY(-6px); opacity:0 } to{ transform:translateY(0); opacity:1 } }
    .lang-item{display:flex; align-items:center; gap:10px; padding:10px 10px; border-radius:10px; cursor:pointer; color:#cfe7dd; font-weight:700;}
    .lang-item:hover{ background:#0b1218; border:1px solid #1d2836 }
    .flag-emoji{display:inline-flex; align-items:center; justify-content:center; width:18px; height:18px; line-height:18px; font-size:14px; border-radius:3px; background:rgba(255,255,255,.06); box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);}

    .page-head{padding:50px 0 10px; background:linear-gradient(180deg, rgba(12,16,20,.65), rgba(10,12,16,.35)), var(--noise); border-bottom:1px solid rgba(255,255,255,.06);}
    .page-head h1{margin:0 0 10px; font-size:36px; letter-spacing:.3px;}
    .page-head .sub{color:var(--muted); margin:0}

    .board{display:grid; grid-template-columns:2fr 1fr; gap:18px; padding:22px 0 36px;}

    .card{background:linear-gradient(180deg, #0f1419, #0c1116); border:1px solid rgba(255,255,255,.06); border-radius:18px; box-shadow:var(--shadow-md); padding:16px;}

    .post{position:relative; display:grid; grid-template-columns:200px 1fr; gap:16px; border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:12px; background:linear-gradient(180deg, #0d1217, #0b0f14); transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease; overflow:hidden;}
    .post::after{content:""; position:absolute; inset:-20%; pointer-events:none; opacity:0; background:radial-gradient(70% 60% at 30% 0%, rgba(35,209,106,.14), transparent 60%); transition:opacity .2s ease;}
    .post:hover{transform:translateY(-3px) scale(1.02); border-color:rgba(35,209,106,.35); box-shadow:0 40px 80px rgba(22,163,74,.18), var(--shadow-md);}
    .post:hover::after{ opacity:1; }

    .thumb{width:100%; height:180px; border-radius:14px; border:1px solid #1d2836; background:#0b1117; overflow:hidden;}
    .thumb img{width:100%; height:100%; object-fit:contain; display:block; background:#0b1117}

    .title{font-size:18px; font-weight:800; margin:0 0 6px}
    .meta{font-size:12px; color:var(--muted); margin:6px 0 10px}

    .aside h3{margin:0 0 10px; font-size:18px}
    .aside .muted{color:var(--muted); margin:0}

    .empty{display:flex; align-items:center; justify-content:center; min-height:240px; border:1px dashed #243040; border-radius:16px; background:linear-gradient(180deg, #0c1218, #0b1016); color:#cfe7dd;}
    .empty .inner{ text-align:center; padding:28px 18px; }
    .empty h3{ margin:0 0 8px; font-size:20px }
    .empty p{ margin:0; color:#9fb0aa }

    .footer{padding:28px 0; border-top:1px solid rgba(255,255,255,.06); color:#a7b9b1; background:#0a0c10;}

    @media (max-width:1140px){ .container{width:1000px} }
    @media (max-width:1000px){ .container{width:920px} .board{grid-template-columns:1fr} .post{grid-template-columns:160px 1fr} .thumb{height:140px} }
    @media (max-width:680px){ .post{grid-template-columns:1fr} .thumb{height:180px} }
  </style>
</head>
<body>
  <!-- ===== NAV ===== -->
  <header class="nav">
    <div class="container row">
      <div class="brand"><span class="dot"></span><span>LinkHash</span></div>
      <nav class="links">
        <a href="{% if meta.lang == 'ko' %}/ko/{% elif meta.lang == 'ja' %}/ja/{% elif meta.lang == 'zh' %}/zh/{% else %}/{% endif %}">
          {% if meta.lang == 'ko' %}Ìôà{% elif meta.lang == 'ja' %}„Éõ„Éº„É†{% elif meta.lang == 'zh' %}‰∏ªÈ°µ{% else %}Home{% endif %}
        </a>
        <a href="{% if meta.lang == 'ko' %}/ko/rewards/{% elif meta.lang == 'ja' %}/ja/rewards/{% elif meta.lang == 'zh' %}/zh/rewards/{% else %}/rewards/{% endif %}">
          {% if meta.lang == 'ko' %}Î¶¨ÏõåÎìú{% elif meta.lang == 'ja' %}„É™„ÉØ„Éº„Éâ{% elif meta.lang == 'zh' %}Â•ñÂä±{% else %}Rewards{% endif %}
        </a>
        <a href="{% if meta.lang == 'ko' %}/ko/events/{% elif meta.lang == 'ja' %}/ja/events/{% elif meta.lang == 'zh' %}/zh/events/{% else %}/events/{% endif %}" style="font-weight:700;color:#d8ffe7">
          {% if meta.lang == 'ko' %}Ïù¥Î≤§Ìä∏{% elif meta.lang == 'ja' %}„Ç§„Éô„É≥„Éà{% elif meta.lang == 'zh' %}Ê¥ªÂä®{% else %}Events{% endif %}
        </a>
        <a href="{% if meta.lang == 'ko' %}/ko/leaderboard/{% elif meta.lang == 'ja' %}/ja/leaderboard/{% elif meta.lang == 'zh' %}/zh/leaderboard/{% else %}/leaderboard/{% endif %}">
          {% if meta.lang == 'ko' %}Î¶¨ÎçîÎ≥¥Îìú{% elif meta.lang == 'ja' %}„É™„Éº„ÉÄ„Éº„Éú„Éº„Éâ{% elif meta.lang == 'zh' %}ÊéíË°åÊ¶ú{% else %}Leaderboard{% endif %}
        </a>
        <a class="btn-outline" href="{% if meta.lang == 'ko' %}/rewards/apply/ko/{% elif meta.lang == 'ja' %}/rewards/apply/ja/{% elif meta.lang == 'zh' %}/rewards/apply/zh/{% else %}/rewards/apply/{% endif %}">
          {% if meta.lang == 'ko' %}Ï∫†ÌéòÏù∏ Ïã†Ï≤≠{% elif meta.lang == 'ja' %}„Ç≠„É£„É≥„Éö„Éº„É≥Áî≥Ë´ã{% elif meta.lang == 'zh' %}Áî≥ËØ∑ÂèëËµ∑Ê¥ªÂä®{% else %}Apply for campaign{% endif %}
        </a>

        {% if wallet_user %}
          <span class="btn-outline">üëõ {{ wallet_user.address|slice:":6" }}‚Ä¶{{ wallet_user.address|slice:"-4:" }}</span>
          <a class="btn" href="#" onclick="logoutWallet && logoutWallet();return false;">
            {% if meta.lang == 'ko' %}Î°úÍ∑∏ÏïÑÏõÉ{% elif meta.lang == 'ja' %}„É≠„Ç∞„Ç¢„Ç¶„Éà{% elif meta.lang == 'zh' %}ÈÄÄÂá∫{% else %}Logout{% endif %}
          </a>
        {% else %}
          <a class="btn" href="#" onclick="connectWallet && connectWallet();return false;">
            {% if meta.lang == 'ko' %}ÏßÄÍ∞ë Ïó∞Í≤∞{% elif meta.lang == 'ja' %}„Ç¶„Ç©„É¨„ÉÉ„ÉàÊé•Á∂ö{% elif meta.lang == 'zh' %}ËøûÊé•Èí±ÂåÖ{% else %}Connect Wallet{% endif %}
          </a>
        {% endif %}

        <!-- Language dropdown -->
        <div class="lang" id="langSwitcher" data-current="{{ meta.lang|default:'en' }}">
          <button class="lang-btn" type="button" aria-haspopup="listbox" aria-expanded="false">
            <span class="flag-emoji" aria-hidden="true"></span>
            <span class="label">
              {% if meta.lang == 'ko' %}ÌïúÍµ≠Ïñ¥{% elif meta.lang == 'ja' %}Êó•Êú¨Ë™û{% elif meta.lang == 'zh' %}‰∏≠Êñá{% else %}English{% endif %}
            </span>
            <svg class="chev" viewBox="0 0 20 20" width="16" height="16" aria-hidden="true">
              <path d="M5 7l5 6 5-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <ul class="lang-menu" role="listbox" tabindex="-1" aria-label="Select language">
            <li class="lang-item" role="option" data-lang="en" data-flag="üá∫üá∏">üá∫üá∏ English</li>
            <li class="lang-item" role="option" data-lang="ko" data-flag="üá∞üá∑">üá∞üá∑ ÌïúÍµ≠Ïñ¥</li>
            <li class="lang-item" role="option" data-lang="ja" data-flag="üáØüáµ">üáØüáµ Êó•Êú¨Ë™û</li>
            <li class="lang-item" role="option" data-lang="zh" data-flag="üá®üá≥">üá®üá≥ ‰∏≠Êñá</li>
          </ul>
        </div>
      </nav>
    </div>
  </header>

  <!-- ===== PAGE HEADER ===== -->
  <section class="page-head">
    <div class="container">
      <h1>
        {% if meta.lang == 'ko' %}Ïù¥Î≤§Ìä∏ & Í≥µÏßÄ{% elif meta.lang == 'ja' %}„Ç§„Éô„É≥„Éà„Éª„ÅäÁü•„Çâ„Åõ{% elif meta.lang == 'zh' %}Ê¥ªÂä®‰∏éÂÖ¨Âëä{% else %}Events & Announcements{% endif %}
      </h1>
      <p class="sub">
        {% if meta.lang == 'ko' %}ÏµúÏã† Ïù¥Î≤§Ìä∏ÏôÄ Í≥µÏßÄÏÇ¨Ìï≠ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.{% elif meta.lang == 'ja' %}ÊúÄÊñ∞„ÅÆ„Ç§„Éô„É≥„Éà„Å®„ÅäÁü•„Çâ„Åõ„Çí„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ{% elif meta.lang == 'zh' %}Êü•ÁúãÊàë‰ª¨ÊúÄÊñ∞ÁöÑÊ¥ªÂä®‰∏éÂÖ¨Âëä„ÄÇ{% else %}Check out our latest announcements and community events.{% endif %}
      </p>
    </div>
  </section>

  <!-- ===== BOARD ===== -->
  <main class="container board">
    <!-- LEFT: Posts list -->
    <section class="card">
      {% if events %}
        {% for ev in events %}
          <article class="post" {% if not forloop.first %}style="margin-top:16px"{% endif %}>
            <div class="thumb">
              {% if ev.thumb_src %}
                <img src="{{ ev.thumb_src }}" alt="{{ ev.title|default:'Event' }}">
              {% else %}
                <img src="{% static 'img/og-cover.png' %}" alt="Event">
              {% endif %}
            </div>
            <div class="content">
              <h3 class="title">{{ ev.title }}</h3>
              <p class="meta">
                {% if meta.lang == 'ko' %}Í≥µÏßÄ ÎÇ†Ïßú{% elif meta.lang == 'ja' %}Êé≤ËºâÊó•{% elif meta.lang == 'zh' %}ÂèëÂ∏ÉÊó∂Èó¥{% else %}Posted on{% endif %}:
                {{ ev.posted_at|date:"Y-m-d" }}
                ¬∑ {{ ev.get_lang_display }}
              </p>
              {% if ev.summary %}
                <p>{{ ev.summary }}</p>
              {% endif %}

              {% if ev.body %}
                <div class="rule">
                  <!-- If body contains HTML you trust, use |safe. If it's Markdown/plain, keep it escaped. -->
                  {{ ev.body|linebreaksbr }}
                </div>
              {% endif %}
            </div>
          </article>
        {% endfor %}
      {% else %}
        <!-- Pretty empty state -->
        <div class="empty">
          <div class="inner">
            <h3>
              {% if meta.lang == 'ko' %}ÏïÑÏßÅ Îì±Î°ùÎêú Í≥µÏßÄÍ∞Ä ÏóÜÏñ¥Ïöî.{% elif meta.lang == 'ja' %}„Åæ„Å†„ÅäÁü•„Çâ„Åõ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ{% elif meta.lang == 'zh' %}ÊöÇÊó∂Ê≤°ÊúâÂÖ¨Âëä„ÄÇ{% else %}No announcements yet.{% endif %}
            </h3>
            <p>
              {% if meta.lang == 'ko' %}Í≥ß ÏóÖÎç∞Ïù¥Ìä∏Îê† ÏòàÏ†ïÏûÖÎãàÎã§. Î¶¨ÏõåÎìú Ï∫†ÌéòÏù∏ÏùÑ Î®ºÏ†Ä ÎëòÎü¨Î≥¥ÏÑ∏Ïöî!{% elif meta.lang == 'ja' %}ËøëÊó•‰∏≠„Å´Êõ¥Êñ∞„Åó„Åæ„Åô„ÄÇÂÖà„Å´„É™„ÉØ„Éº„Éâ„Çí„ÅîË¶ß„Åè„Å†„Åï„ÅÑÔºÅ{% elif meta.lang == 'zh' %}Êàë‰ª¨ÂæàÂø´‰ºöÊõ¥Êñ∞„ÄÇÂÖàÂéªÁúãÁúãÂ•ñÂä±Ê¥ªÂä®ÂêßÔºÅ{% else %}We‚Äôll post updates soon. In the meantime, check out our rewards!{% endif %}
            </p>
            <div style="margin-top:14px;">
              <a class="btn" href="{% if meta.lang == 'ko' %}/ko/rewards/{% elif meta.lang == 'ja' %}/ja/rewards/{% elif meta.lang == 'zh' %}/zh/rewards/{% else %}/rewards/{% endif %}">
                {% if meta.lang == 'ko' %}Î¶¨ÏõåÎìú Î≥¥Îü¨Í∞ÄÍ∏∞{% elif meta.lang == 'ja' %}„É™„ÉØ„Éº„Éâ„ÇíË¶ã„Çã{% elif meta.lang == 'zh' %}Êü•ÁúãÂ•ñÂä±{% else %}View Rewards{% endif %}
              </a>
            </div>
          </div>
        </div>
      {% endif %}
    </section>

    <!-- RIGHT: Notes -->
    <aside class="card aside">
      <h3>{% if meta.lang == 'ko' %}ÏïàÎÇ¥{% elif meta.lang == 'ja' %}„ÅîÊ°àÂÜÖ{% elif meta.lang == 'zh' %}ËØ¥Êòé{% else %}Notes{% endif %}</h3>
      <p class="muted">
        {% if meta.lang == 'ko' %}
          ÏóêÏñ¥ÎìúÎûçÏùÄ Í≥ºÏ†ú Í≤ÄÏàò ÌõÑ ÏàúÏ∞® ÏßÄÍ∏âÎê©ÎãàÎã§. Î¥á/Ï§ëÎ≥µ Ï∞∏Ïó¨Îäî Ï†úÏô∏Îê† Ïàò ÏûàÏäµÎãàÎã§.
        {% elif meta.lang == 'ja' %}
          „Ç®„Ç¢„Éâ„É≠„ÉÉ„Éó„ÅØÂØ©ÊüªÂæå„Å´È†ÜÊ¨°ÈÖçÂ∏É„Åó„Åæ„Åô„ÄÇ„Éú„ÉÉ„Éà/ÈáçË§áÂèÇÂä†„ÅØÈô§Â§ñ„Åï„Çå„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
        {% elif meta.lang == 'zh' %}
          Á©∫ÊäïÂ∞ÜÂú®ÂÆ°Ê†∏Âêé‰æùÊ¨°ÂèëÊîæ„ÄÇÊú∫Âô®‰∫∫ÊàñÈáçÂ§çÂèÇ‰∏éÂèØËÉΩ‰ºöË¢´ÊéíÈô§„ÄÇ
        {% else %}
          Airdrops are distributed after review. Bot/duplicate entries may be excluded.
        {% endif %}
      </p>
      <div style="margin-top:14px; display:flex; gap:10px;">
        <a class="btn" href="{% if meta.lang == 'ko' %}/ko/rewards/{% elif meta.lang == 'ja' %}/ja/rewards/{% elif meta.lang == 'zh' %}/zh/rewards/{% else %}/rewards/{% endif %}">
          {% if meta.lang == 'ko' %}Î¶¨ÏõåÎìú ÌîÑÎ°úÍ∑∏Îû® Î∞îÎ°úÍ∞ÄÍ∏∞{% elif meta.lang == 'ja' %}„É™„ÉØ„Éº„Éâ„Å∏{% elif meta.lang == 'zh' %}ÂâçÂæÄÂ•ñÂä±{% else %}Go to Rewards Program{% endif %}
        </a>
        <a class="btn-outline" href="{% if meta.lang == 'ko' %}/rewards/apply/ko/{% elif meta.lang == 'ja' %}/rewards/apply/ja/{% elif meta.lang == 'zh' %}/rewards/apply/zh/{% else %}/rewards/apply/{% endif %}">
          {% if meta.lang == 'ko' %}Ï∫†ÌéòÏù∏ Ïã†Ï≤≠{% elif meta.lang == 'ja' %}„Ç≠„É£„É≥„Éö„Éº„É≥Áî≥Ë´ã{% elif meta.lang == 'zh' %}Áî≥ËØ∑ÂèëËµ∑Ê¥ªÂä®{% else %}Apply for a Campaign{% endif %}
        </a>
      </div>
    </aside>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="footer">
    <div class="container" style="display:flex; align-items:center; justify-content:space-between;">
      <div>¬© <strong>LinkHash</strong></div>
      <div style="opacity:.7">White-hat backlinks ¬∑ Transparent rewards</div>
    </div>
  </footer>

  <script>
    (function(){
      const $wrap = document.getElementById('langSwitcher');
      if(!$wrap) return;
      const $btn  = $wrap.querySelector('.lang-btn');
      const $menu = $wrap.querySelector('.lang-menu');
      const current = ($wrap.dataset.current || 'en').toLowerCase();

      const flagEl = $btn.querySelector('.flag-emoji');
      const flagMap = { en:'üá∫üá∏', ko:'üá∞üá∑', ja:'üáØüáµ', zh:'üá®üá≥' };
      flagEl.textContent = flagMap[current] || 'üá∫üá∏';

      function close(){ $wrap.classList.remove('open'); $btn.setAttribute('aria-expanded','false'); }
      $btn.addEventListener('click', (e)=>{ e.stopPropagation(); $wrap.classList.toggle('open'); $btn.setAttribute('aria-expanded', $wrap.classList.contains('open')); });
      document.addEventListener('click', ()=> close());
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') close(); });

      function pathFor(lang){
        const loc = window.location;
        const path = loc.pathname;
        const clean = path.replace(/^\/(ko|ja|zh)(\/|$)/, '/'); // strip locale prefix if any

        const baseMap = { '/': true, '/rewards/': true, '/events/': true, '/leaderboard/': true };

        const isApply = /^\/rewards\/apply(\/(ko|ja|zh)\/)?$/.test(path);
        if(isApply){
          if(lang === 'en') return '/rewards/apply/?lang=en';
          return `/rewards/apply/${lang}/`;
        }

        if(baseMap[clean]){
          if(lang === 'en'){
            const q = new URLSearchParams(loc.search);
            q.set('lang','en');
            return clean + (q.toString() ? `?${q.toString()}` : '');
          }
          return clean === '/' ? `/${lang}/` : `/${lang}${clean}`;
        }

        const params = new URLSearchParams(loc.search);
        params.set('lang', lang);
        return path + (params.toString() ? `?${params.toString()}` : '');
      }

      $menu.querySelectorAll('.lang-item').forEach(li=>{
        li.addEventListener('click', ()=>{
          const lang = li.getAttribute('data-lang');
          const emoji = li.getAttribute('data-flag') || '';
          flagEl.textContent = emoji;
          $wrap.querySelector('.label').textContent =
            lang==='ko' ? 'ÌïúÍµ≠Ïñ¥' : lang==='ja' ? 'Êó•Êú¨Ë™û' : lang==='zh' ? '‰∏≠Êñá' : 'English';
          close();
          const target = pathFor(lang);
          if(target) window.location.href = target;
        });
      });
    })();
  </script>

  <script>
    // CSRF + wallet helper (same as your other pages)
    function getCookie(name){
      const m = document.cookie.match(new RegExp('(^|; )' + encodeURIComponent(name) + '=([^;]*)'));
      return m ? decodeURIComponent(m[2]) : null;
    }
    async function apiGet(url){
      const r = await fetch(url, { credentials: 'same-origin' });
      if(!r.ok) throw new Error((await r.text()) || ('GET ' + url + ' failed'));
      return r.json();
    }
    async function apiPost(url, json){
      const r = await fetch(url, {
        method: 'POST',
        credentials: 'same-origin',
        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') || '' },
        body: JSON.stringify(json || {})
      });
      if(!r.ok){
        let msg;
        try{ msg = (await r.json()).error }catch(e){ msg = await r.text(); }
        throw new Error(msg || ('POST ' + url + ' failed'));
      }
      return r.json();
    }
    async function connectWallet(){
      try{
        if(!window.ethereum){ alert('MetaMask not detected. Please install MetaMask.'); return; }
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const address = (accounts && accounts[0]) ? accounts[0] : null;
        if(!address){ alert('No account selected.'); return; }
        const nonceRes = await apiGet(`/api/auth/nonce?address=${encodeURIComponent(address)}`);
        if(!nonceRes.ok){ throw new Error(nonceRes.error || 'nonce error'); }
        const message = nonceRes.message || `LinkHash login\n\nNonce: ${nonceRes.nonce}\n\nThis signature proves you control this wallet.`;
        const signature = await window.ethereum.request({ method: 'personal_sign', params: [ message, address ] });
        const verifyRes = await apiPost('/api/auth/verify', { address, signature, message });
        if(verifyRes && verifyRes.ok){ window.location.reload(); } else { alert('Login failed.'); }
      }catch(err){ console.error(err); alert('Wallet login failed: ' + (err && err.message ? err.message : err)); }
    }
    async function logoutWallet(){ try{ await apiPost('/api/auth/logout', {}); window.location.reload(); }catch(err){ console.error(err); alert('Logout failed: ' + (err && err.message ? err.message : err)); } }
    window.connectWallet = connectWallet; window.logoutWallet = logoutWallet;
  </script>
</body>
</html>
