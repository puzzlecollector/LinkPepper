<!doctype html>
{% load static %}
<html lang="{{ meta.lang|default:'en' }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
        <title>{{ meta.title|default:"LinkHash | Rewards" }}</title>
        <link rel="canonical" href="{{ meta.canonical|default:meta.url }}">
        <meta name="robots" content="index,follow">
        <meta name="author" content="LinkHash">
        <meta name="description" content="{{ meta.description|default:'Earn USDT for white-hat contributions.' }}">
        <!-- OG/Twitter -->
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="LinkHash">
        <meta property="og:title" content="{{ meta.og_title|default:meta.title }}">
        <meta property="og:description" content="{{ meta.og_description|default:meta.description }}">
        <meta property="og:url" content="{{ meta.url }}">
        <meta property="og:image" content="{% static 'img/og-cover.png' %}">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="{{ meta.og_title|default:meta.title }}">
        <meta name="twitter:description" content="{{ meta.og_description|default:meta.description }}">
        <meta name="twitter:image" content="{% static 'img/twitter-card.png' %}">
        <!-- Favicons -->
        <link rel="icon" href="{% static 'img/favicon.ico' %}">
        <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/apple-touch-icon.png' %}">
        <style>
      /* ===== Theme (mobile-first, matches home vibe) ===== */
      :root{
        --bg:#0a0b0d; --bg-elev:#0f1115; --panel:#11141a; --panel-2:#0e1318; --grid:#0b0f13; --line:#1a212d;
        --text:#e6f1ee; --muted:#9fb0aa; --green:#16a34a; --green-2:#23d16a;
        --glow:0 0 22px rgba(22,163,74,.35), 0 0 48px rgba(22,163,74,.15);
        --radius:14px; --shadow-lg:0 30px 60px rgba(0,0,0,.55), inset 0 -1px 0 rgba(255,255,255,.03);
        --shadow-md:0 14px 34px rgba(0,0,0,.45);
        --noise:transparent url('data:image/svg+xml;utf8,\
          <svg xmlns="http://www.w3.org/2000/svg" width=\"120\" height=\"120\" viewBox=\"0 0 120 120\">\
          <filter id=\"n\"><feTurbulence type=\"fractalNoise\" baseFrequency=\"0.9\" numOctaves=\"2\" stitchTiles=\"stitch\"/></filter>\
          <rect width=\"120\" height=\"120\" filter=\"url(%23n)\" opacity=\".04\"/></svg>') repeat;
        --container:clamp(320px, 92vw, 840px);
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0; color:var(--text);
        background:
          radial-gradient(40rem 30rem at 90% -10%, rgba(22,163,74,.12), transparent 60%),
          radial-gradient(30rem 20rem at -20% 20%, rgba(35,209,106,.08), transparent 60%),
          linear-gradient(180deg, #08090b, #0a0b0d 20%, #090c10);
        font-family: ui-sans-serif, "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Apple SD Gothic Neo","Noto Sans KR","Noto Sans JP","Noto Sans SC", Arial, sans-serif;
        letter-spacing:.2px;
        background-attachment: fixed;
      }
      a{color:inherit;text-decoration:none}
      .container{width:var(--container); margin:0 auto; padding:0 8px;}

      /* ===== Nav (compact) ===== */
      .nav{
        position:sticky; top:0; z-index:60; backdrop-filter: blur(12px);
        background:linear-gradient(180deg, rgba(15,17,21,.75), rgba(15,17,21,.45));
        border-bottom:1px solid rgba(255,255,255,.06);
      }
      .nav .row{display:flex; align-items:center; justify-content:space-between; height:64px; gap:10px;}
      .brand{display:flex; align-items:center; gap:8px; font-weight:800; letter-spacing:.3px; color:#d8ffe7; text-shadow:0 0 18px rgba(35,209,106,.24);}
      .brand .dot{width:8px;height:8px;border-radius:999px;background:var(--green);box-shadow:var(--glow)}
      .links{display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end}
      .link-min{padding:8px 10px; border-radius:10px; border:1px solid #2a333f; background: rgba(14,18,25,.6); color:#d9f6e6; font-weight:800; font-size:12px}
      .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; font-weight:800; border-radius:12px; background:linear-gradient(180deg,#19b357,#119e49); color:#05160c; box-shadow:var(--glow); border:1px solid #2fe07a; font-size:13px}
      .btn-outline{padding:8px 10px; border-radius:10px; border:1px solid #2a333f; background: rgba(14,18,25,.6); color:#d9f6e6; font-weight:700; font-size:12px}
      .pill-addr{max-width:140px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}

      /* Language dropdown */
      .lang{ position:relative;}
      .lang-btn{
        display:inline-flex; align-items:center; gap:8px; padding:8px 10px; font-weight:800; border-radius:10px;
        border:1px solid #2a333f; background: rgba(14,18,25,.6); color:#d9f6e6; cursor:pointer; font-size:12px
      }
      .lang-btn:hover{ border-color:rgba(35,209,106,.35); box-shadow:0 0 16px rgba(35,209,106,.18) }
      .lang-menu{
        position:absolute; top:110%; right:0; width:210px; background:linear-gradient(180deg, #0f1419, #0c1116);
        border:1px solid rgba(255,255,255,.08); border-radius:12px; box-shadow:0 20px 40px rgba(0,0,0,.45);
        padding:6px; display:none; z-index:70;
      }
      .lang.open .lang-menu{ display:block; animation:menuIn .14s ease-out }
      @keyframes menuIn{ from{ transform:translateY(-6px); opacity:0 } to{ transform:translateY(0); opacity:1 } }
      .lang-item{display:flex; align-items:center; gap:10px; padding:10px 10px; border-radius:10px; cursor:pointer; color:#cfe7dd; font-weight:700;}
      .lang-item:hover{ background:#0b1218; border:1px solid #1d2836 }
      .flag-emoji{
        display:inline-flex; align-items:center; justify-content:center; width:18px; height:18px; font-size:14px; border-radius:3px;
        background:rgba(255,255,255,.06); box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);
      }

      /* ===== Page header ===== */
      .page-head{
        padding:28px 0 10px;
        background:linear-gradient(180deg, rgba(12,16,20,.65), rgba(10,12,16,.35)), var(--noise);
        border-bottom:1px solid rgba(255,255,255,.06);
      }
      .page-head h1{margin:0 0 8px; font-size:24px; letter-spacing:.3px;}
      .page-head .sub{color:var(--muted); margin:0; font-size:14px}

      /* ===== Tabs & filter bar ===== */
      .controls{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 0 16px;}
      .tabs{display:flex; gap:8px;}
      .tab{
        padding:10px 14px; border-radius:999px; border:1px solid #2a333f;
        background:linear-gradient(180deg, rgba(14,18,25,.85), rgba(14,18,25,.55));
        color:#cfe7dd; font-weight:800; cursor:pointer; letter-spacing:.2px; font-size:13px;
        transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease;
      }
      .tab:hover{ transform:translateY(-2px); border-color:rgba(35,209,106,.35); box-shadow:0 14px 30px rgba(22,163,74,.18) }
      .tab.active{
        border-color:#2fe07a; color:#05160c; background:linear-gradient(180deg,#19b357,#119e49); box-shadow:var(--glow);
        transform:translateY(-1px);
      }

      .filters{display:flex; gap:8px; align-items:center; overflow-x:auto; -webkit-overflow-scrolling:touch; padding-bottom:2px;}
      .filters::-webkit-scrollbar{height:8px} .filters::-webkit-scrollbar-thumb{background:#22303e; border-radius:8px}
      .dropdown{position:relative; flex:0 0 auto;}
      .dropdown-toggle{
        display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; border:1px solid #2a333f;
        background:#0b1117; color:#d9f6e6; font-weight:800; cursor:pointer; font-size:12px;
        transition:border-color .15s ease, box-shadow .15s ease, transform .15s ease;
      }
      .dropdown-toggle:hover{ border-color:rgba(35,209,106,.35); box-shadow:0 10px 22px rgba(22,163,74,.15) }
      .dropdown-menu{
        position:absolute; top:110%; left:0; min-width:220px; padding:6px; display:none; z-index:25;
        background:linear-gradient(180deg, #0f1419, #0c1116); border:1px solid rgba(255,255,255,.08); border-radius:14px; box-shadow:var(--shadow-md);
      }
      .dropdown.open .dropdown-menu{ display:block; }
      .dropdown-menu [role="option"]{ padding:8px 10px; border-radius:10px; cursor:pointer; font-weight:700; color:#cfe7dd; }
      .dropdown-menu [role="option"]:hover{ background:rgba(22,163,74,.12); color:#eafff4; }
      .dropdown-menu [aria-selected="true"]{ background:rgba(22,163,74,.18); color:#eafff4; border:1px solid rgba(35,209,106,.35); }

      /* ===== Card grid (1-column on mobile) ===== */
      .grid{ display:grid; grid-template-columns:1fr; gap:12px; }
      .project-card{
        position:relative; width:100%; display:flex; flex-direction:column; overflow:hidden;
        background:linear-gradient(180deg, #0d1217, #0b0f14); border:1px solid rgba(255,255,255,.06);
        border-radius:16px; box-shadow:var(--shadow-md); opacity:0; transform:translateY(6px);
        transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease, opacity .25s ease;
      }
      .project-card:hover{ transform:translateY(-2px); border-color:rgba(35,209,106,.35); box-shadow:0 30px 60px rgba(22,163,74,.18), var(--shadow-md); }
      .project-card .thumb{position:relative; height:170px; background:#0b1117; overflow:hidden;}
      .project-card .thumb img{width:100%; height:100%; object-fit:cover; display:block; opacity:.92; transform:scale(1.02)}
      .task-badges{position:absolute; left:10px; bottom:10px; display:flex; gap:6px;}
      .task-badge{padding:6px 10px; border-radius:999px; font-size:11px; font-weight:800; background:rgba(14,18,25,.8); border:1px solid rgba(255,255,255,.08);}
      .task-badge.visit{color:#a0f2bd; border-color:#2a6f47}
      .task-badge.link{color:#b2f5ff; border-color:#2a455e}
      .project-card .body{flex:1; padding:12px; display:flex; flex-direction:column; gap:8px;}
      .project-card h3{font-size:16px; margin:0}
      .project-card p{color:#b7c8c1; font-size:13px; margin:0 0 4px}
      .meta{display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:4px;}
      .pill{background:#0b1218; border:1px solid #1d2836; border-radius:10px; padding:7px 8px; font-size:12px; color:#cde6da; display:flex; align-items:center; gap:6px;}
      .progress{height:8px; background:#0b1218; border:1px solid #1d2836; border-radius:999px; overflow:hidden; margin-top:6px;}
      .progress .bar{height:100%; width:0; background:linear-gradient(90deg,#19b357,#23d16a); box-shadow:var(--glow)}
      .foot{display:flex; justify-content:flex-end; margin-top:auto;}
      .foot .btn{padding:9px 10px; font-size:12px}

      .panel{display:none;}
      .panel.active{display:block;}

      /* Empty states */
      .empty-state{border:1px solid rgba(255,255,255,.08); background:linear-gradient(180deg,#0f1419,#0c1116); border-radius:16px; box-shadow:var(--shadow-md); padding:16px; color:#cfe7dd;}
      .empty-state h3{ margin:0 0 6px; font-size:16px; }
      .empty-state p{ margin:0; color:#9fb0aa; font-size:13px; }

      /* Footer */
      .footer{padding:18px 0 24px; border-top:1px solid rgba(255,255,255,.06); color:#a7b9b1; background:#0a0c10; font-size:12px; margin-top:18px}
            /* ===== MOBILE HEADER (namespaced .mnav) ===== */
.mnav{position:sticky; top:0; z-index:80; padding-top:env(safe-area-inset-top);
  background:linear-gradient(180deg, rgba(15,17,21,.82), rgba(15,17,21,.52));
  backdrop-filter: blur(12px); border-bottom:1px solid rgba(255,255,255,.06);}
.mnav-bar{display:flex; align-items:center; justify-content:space-between; height:56px; gap:8px;}

.mnav-brand{display:inline-flex; align-items:center; gap:8px; font-weight:800; color:#d8ffe7; text-shadow:0 0 14px rgba(35,209,106,.22);}
.mnav-brand .dot{width:8px;height:8px;border-radius:999px;background:#16a34a;box-shadow:0 0 16px rgba(22,163,74,.42)}
.mnav-brand .name{font-size:16px; letter-spacing:.2px}

.mnav-actions{display:flex; align-items:center; gap:8px;}
.mnav .btn{display:inline-flex; align-items:center; gap:6px; padding:8px 10px; font-weight:800; border-radius:10px; border:1px solid #2fe07a;
  background:linear-gradient(180deg,#19b357,#119e49); color:#05160c; box-shadow:0 0 22px rgba(22,163,74,.25);}
.mnav .pill-addr{max-width:130px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; border:1px solid #2a333f; background:#0b1117;
  color:#d9f6e6; border-radius:999px; padding:6px 10px; font-size:12px; font-weight:700;}

.mnav-toggle{display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:10px;
  border:1px solid #2a333f; background:#0b1117; color:#e6f1ee;}
.mnav-toggle:active{transform:scale(.98)}

/* Sheet */
.mnav-sheet{position:relative; background:linear-gradient(180deg,#0f1419,#0c1116);
  border-top:1px solid rgba(255,255,255,.06); box-shadow:0 30px 60px rgba(0,0,0,.5);
  padding:12px 12px calc(12px + env(safe-area-inset-bottom));}
.mnav-sheet[hidden]{display:none;}
.mnav-list{display:grid; gap:8px; margin:4px 0 10px;}
.mnav-list .item{display:flex; align-items:center; gap:8px; padding:12px 12px; border-radius:12px; font-weight:800;
  border:1px solid #263040; background:rgba(14,18,25,.65); color:#cfe7dd;}
.mnav-list .item:hover{border-color:rgba(35,209,106,.35); box-shadow:0 0 16px rgba(35,209,106,.18)}
.mnav-list .item.active{color:#05160c; border-color:#2fe07a; background:linear-gradient(180deg,#19b357,#119e49); box-shadow:0 0 22px rgba(22,163,74,.25)}
.mnav-list .item.outline{background:#0b1117}

/* Language */
.mnav-lang{margin:2px 0 10px; position:relative;}
.mnav .lang-btn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; font-weight:800; border-radius:12px; border:1px solid #2a333f; background:#0b1117; color:#cfe7dd}
.mnav .flag-emoji{display:inline-flex; align-items:center; justify-content:center; width:18px; height:18px; line-height:18px; font-size:14px; border-radius:3px;
  background:rgba(255,255,255,.06); box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);}
.mnav .lang-menu{position:absolute; top:110%; left:0; min-width:200px; padding:6px; margin:0; list-style:none; display:none; z-index:90;
  background:linear-gradient(180deg,#0f1419,#0c1116); border:1px solid rgba(255,255,255,.08); border-radius:12px; box-shadow:0 20px 40px rgba(0,0,0,.45)}
.mnav .lang.open .lang-menu{display:block; animation:mnavMenuIn .14s ease-out}
@keyframes mnavMenuIn{from{transform:translateY(-6px);opacity:0} to{transform:translateY(0);opacity:1}}
.mnav .lang-item{display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; cursor:pointer; color:#cfe7dd; font-weight:700;}
.mnav .lang-item:hover{ background:#0b1218; border:1px solid #1d2836 }

/* Logout button inside sheet */
.mnav .danger{width:100%; margin-top:6px; padding:11px 12px; border-radius:12px; border:1px solid #3b2020;
  background:linear-gradient(180deg,#6e2c2c,#5a2222); color:#ffeaea; font-weight:800}

/* Ultra-narrow friendliness (Galaxy Fold cover width ~320px) */
@media (max-width:360px){
  .mnav .pill-addr{max-width:98px}
  .mnav-bar{height:52px}
  .mnav-brand .name{font-size:15px}
}

/* Large-fold (unfolded) still uses mobile header but breathes a bit */
@media (min-width:720px){
  .mnav-bar{height:60px}
}
      /* Utilities */
      .muted{color:#9fb0aa}
      .sr-only{position:absolute!important; width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
        </style>
    </head>
    <body>
        <!-- ===== NAV ===== -->
        <!-- ===== MOBILE HEADER (copy/paste) ===== -->
        <header class="mnav" role="banner">
            <div class="container mnav-bar">
                <a href="{% if meta.lang == 'ko' %}/ko/{% elif meta.lang == 'ja' %}/ja/{% elif meta.lang == 'zh' %}/zh/{% else %}/{% endif %}" class="mnav-brand" aria-label="LinkHash Home">
                    <span class="dot" aria-hidden="true"></span>
                    <span class="name">LinkHash</span>
                </a>
                <div class="mnav-actions">
                    {% if wallet_user %}
                    <span class="pill-addr" title="{{ wallet_user.address }}">ğŸ‘› {{ wallet_user.address|slice:":6" }}â€¦{{ wallet_user.address|slice:"-4:" }}</span>
                    {% else %}
                    <button class="btn" type="button" onclick="(window.connectWallet||(()=>alert('Wallet script missing')))()">
                        {% if meta.lang == 'ko' %}ì§€ê°‘{% elif meta.lang == 'ja' %}ã‚¦ã‚©ãƒ¬ãƒƒãƒˆ{% elif meta.lang == 'zh' %}é’±åŒ…{% else %}Wallet{% endif %}
                    </button>
                    {% endif %}
                    <button
                        class="mnav-toggle"
                        id="mnavToggle"
                        type="button"
                        aria-controls="mnavSheet"
                        aria-expanded="false"
                        aria-label="Menu"
                    >
                        <svg
                            viewBox="0 0 24 24"
                            width="22"
                            height="22"
                            aria-hidden="true"
                        >
                            <path
                                d="M4 6h16M4 12h16M4 18h16"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                        </svg>
                    </button>
                </div>
            </div>
            <!-- Slide-down sheet -->
            <div class="mnav-sheet" id="mnavSheet" hidden>
                <nav class="mnav-list" aria-label="Primary">
                    <a class="item" href="{% if meta.lang == 'ko' %}/ko/{% elif meta.lang == 'ja' %}/ja/{% elif meta.lang == 'zh' %}/zh/{% else %}/{% endif %}">
                        ğŸ  {% if meta.lang == 'ko' %}í™ˆ{% elif meta.lang == 'ja' %}ãƒ›ãƒ¼ãƒ {% elif meta.lang == 'zh' %}ä¸»é¡µ{% else %}Home{% endif %}
                    </a>
                    <a class="item active" href="{% if meta.lang == 'ko' %}/ko/rewards/{% elif meta.lang == 'ja' %}/ja/rewards/{% elif meta.lang == 'zh' %}/zh/rewards/{% else %}/rewards/{% endif %}">
                        ğŸ {% if meta.lang == 'ko' %}ë¦¬ì›Œë“œ{% elif meta.lang == 'ja' %}ãƒªãƒ¯ãƒ¼ãƒ‰{% elif meta.lang == 'zh' %}å¥–åŠ±{% else %}Rewards{% endif %}
                    </a>
                    <a class="item" href="{% if meta.lang == 'ko' %}/ko/events/{% elif meta.lang == 'ja' %}/ja/events/{% elif meta.lang == 'zh' %}/zh/events/{% else %}/events/{% endif %}">
                        ğŸ“£ {% if meta.lang == 'ko' %}ì´ë²¤íŠ¸{% elif meta.lang == 'ja' %}ã‚¤ãƒ™ãƒ³ãƒˆ{% elif meta.lang == 'zh' %}æ´»åŠ¨{% else %}Events{% endif %}
                    </a>
                    <a class="item" href="{% if meta.lang == 'ko' %}/ko/leaderboard/{% elif meta.lang == 'ja' %}/ja/leaderboard/{% elif meta.lang == 'zh' %}/zh/leaderboard/{% else %}/leaderboard/{% endif %}">
                        ğŸ† {% if meta.lang == 'ko' %}ë¦¬ë”ë³´ë“œ{% elif meta.lang == 'ja' %}ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰{% elif meta.lang == 'zh' %}æ’è¡Œæ¦œ{% else %}Leaderboard{% endif %}
                    </a>
                    <a class="item outline" href="{% if meta.lang == 'ko' %}/rewards/apply/ko/{% elif meta.lang == 'ja' %}/rewards/apply/ja/{% elif meta.lang == 'zh' %}/rewards/apply/zh/{% else %}/rewards/apply/{% endif %}">
                        ğŸ“ {% if meta.lang == 'ko' %}ìº í˜ì¸ ì‹ ì²­{% elif meta.lang == 'ja' %}ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ç”³è«‹{% elif meta.lang == 'zh' %}ç”³è¯·å‘èµ·æ´»åŠ¨{% else %}Apply for campaign{% endif %}
                    </a>
                </nav>
                <!-- Language switcher -->
                <div class="mnav-lang" id="langSwitcher" data-current="{{ meta.lang|default:'en' }}">
                    <button
                        class="lang-btn"
                        type="button"
                        aria-haspopup="listbox"
                        aria-expanded="false"
                    >
                        <span class="flag-emoji" aria-hidden="true"></span>
                        <span class="label">
                            {% if meta.lang == 'ko' %}í•œêµ­ì–´{% elif meta.lang == 'ja' %}æ—¥æœ¬èª{% elif meta.lang == 'zh' %}ä¸­æ–‡{% else %}English{% endif %}
                        </span>
                        <svg
                            class="chev"
                            viewBox="0 0 20 20"
                            width="14"
                            height="14"
                            aria-hidden="true"
                        >
                            <path
                                d="M5 7l5 6 5-6"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                        </svg>
                    </button>
                    <ul
                        class="lang-menu"
                        role="listbox"
                        tabindex="-1"
                        aria-label="Select language"
                    >
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="en"
                            data-flag="ğŸ‡ºğŸ‡¸"
                        >ğŸ‡ºğŸ‡¸ English</li>
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="ko"
                            data-flag="ğŸ‡°ğŸ‡·"
                        >ğŸ‡°ğŸ‡· í•œêµ­ì–´</li>
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="ja"
                            data-flag="ğŸ‡¯ğŸ‡µ"
                        >ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</li>
                        <li
                            class="lang-item"
                            role="option"
                            data-lang="zh"
                            data-flag="ğŸ‡¨ğŸ‡³"
                        >ğŸ‡¨ğŸ‡³ ä¸­æ–‡</li>
                    </ul>
                </div>
                {% if wallet_user %}
                <button class="danger" type="button" onclick="(window.logoutWallet||(()=>alert('Wallet script missing')))()">
                    {% if meta.lang == 'ko' %}ë¡œê·¸ì•„ì›ƒ{% elif meta.lang == 'ja' %}ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ{% elif meta.lang == 'zh' %}é€€å‡º{% else %}Logout{% endif %}
                </button>
                {% endif %}
            </div>
        </header>
        <!-- ===== Page header ===== -->
        <section class="page-head">
            <div class="container">
                <h1>
                    {% if meta.lang == 'ko' %}ë¦¬ì›Œë“œ ìº í˜ì¸{% elif meta.lang == 'ja' %}ãƒªãƒ¯ãƒ¼ãƒ‰ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³{% elif meta.lang == 'zh' %}å¥–åŠ±æ´»åŠ¨{% else %}Reward Campaigns{% endif %}
                </h1>
                <p class="sub">
                    {% if meta.lang == 'ko' %}í™”ì´íŠ¸í–‡ í™œë™ìœ¼ë¡œ USDTë¥¼ ì ë¦½í•˜ì„¸ìš”. ì‹¤ì‹œê°„ ì§„í–‰ë¥ ê³¼ íˆ¬ëª…í•œ ê·œì¹™.{% elif meta.lang == 'ja' %}ãƒ›ãƒ¯ã‚¤ãƒˆãƒãƒƒãƒˆæ´»å‹•ã§USDTã‚’ç²å¾—ã€‚é€²æ—ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã€ãƒ«ãƒ¼ãƒ«ã¯é€æ˜ã€‚{% elif meta.lang == 'zh' %}é€šè¿‡ç™½å¸½è´¡çŒ®èµšå–USDTã€‚å®æ—¶è¿›åº¦ï¼Œè§„åˆ™é€æ˜ã€‚{% else %}Earn USDT for white-hat contributions. Live progress and transparent rules.{% endif %}
                </p>
                <div class="controls">
                    <div class="tabs" role="tablist" aria-label="Campaign tabs">
                        <button
                            class="tab active"
                            data-target="#live"
                            role="tab"
                            aria-selected="true"
                            id="tab-live"
                        >
                            {% if meta.lang == 'ko' %}ì§„í–‰ì¤‘{% elif meta.lang == 'ja' %}é€²è¡Œä¸­{% elif meta.lang == 'zh' %}è¿›è¡Œä¸­{% else %}Live{% endif %}
                        </button>
                        <button
                            class="tab"
                            data-target="#past"
                            role="tab"
                            aria-selected="false"
                            id="tab-past"
                        >
                            {% if meta.lang == 'ko' %}ì¢…ë£Œë¨{% elif meta.lang == 'ja' %}çµ‚äº†{% elif meta.lang == 'zh' %}å·²ç»“æŸ{% else %}Past{% endif %}
                        </button>
                    </div>
                    <div class="filters">
                        <div class="dropdown" id="sortDropdown" data-value="ending">
                            <button
                                class="dropdown-toggle"
                                type="button"
                                aria-haspopup="listbox"
                                aria-expanded="false"
                            >
                                <span class="dropdown-label">
                                    {% if meta.lang == 'ko' %}ë§ˆê° ì„ë°•{% elif meta.lang == 'ja' %}ã¾ã‚‚ãªãçµ‚äº†{% elif meta.lang == 'zh' %}å³å°†ç»“æŸ{% else %}Ending soon{% endif %}
                                </span>
                                <span class="caret" aria-hidden="true">â–¾</span>
                            </button>
                            <ul class="dropdown-menu" role="listbox" aria-labelledby="sortDropdown">
                                <li role="option" data-value="ending" aria-selected="true">
                                    {% if meta.lang == 'ko' %}ë§ˆê° ì„ë°•{% elif meta.lang == 'ja' %}ã¾ã‚‚ãªãçµ‚äº†{% elif meta.lang == 'zh' %}å³å°†ç»“æŸ{% else %}Ending soon{% endif %}
                                </li>
                                <li role="option" data-value="new">
                                    {% if meta.lang == 'ko' %}ìµœì‹  ì‹œì‘{% elif meta.lang == 'ja' %}æ–°ç€{% elif meta.lang == 'zh' %}æœ€æ–°ä¸Šçº¿{% else %}Newly launched{% endif %}
                                </li>
                                <li role="option" data-value="payout">
                                    {% if meta.lang == 'ko' %}ê°œë³„ ë³´ìƒ í¼{% elif meta.lang == 'ja' %}æœ€å¤§å ±é…¬{% elif meta.lang == 'zh' %}å•æ¬¡å¥–åŠ±æœ€é«˜{% else %}Biggest payout{% endif %}
                                </li>
                                <li role="option" data-value="pool">
                                    {% if meta.lang == 'ko' %}ë¦¬ì›Œë“œ í’€ í¼{% elif meta.lang == 'ja' %}æœ€å¤§ãƒ—ãƒ¼ãƒ«{% elif meta.lang == 'zh' %}å¥–åŠ±æ± æœ€å¤§{% else %}Largest pool{% endif %}
                                </li>
                                <li role="option" data-value="popular">
                                    {% if meta.lang == 'ko' %}ì¸ê¸° ìº í˜ì¸{% elif meta.lang == 'ja' %}äººæ°—é †{% elif meta.lang == 'zh' %}æœ€å—æ¬¢è¿{% else %}Most popular{% endif %}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- ===== Panels ===== -->
        <main class="container" style="padding:14px 0 0">
            <!-- LIVE -->
            <section id="live" class="panel active" aria-labelledby="tab-live">
                <div class="grid" id="liveGrid">
                    {% if projects %}
            {% for c in projects %}
                    <article
                        class="project-card"
                        data-start="{{ c.start|date:'Y-m-d' }}"
                        data-end="{{ c.end|date:'Y-m-d' }}"
                        data-pool="{{ c.pool_usdt|default:0 }}"
                        data-payout="{{ c.payout_usdt|default:0 }}"
                        data-pop="{{ c.participants|default:0 }}"
                    >
                        <div class="thumb">
                            <img src="{{ c.image_url|default:'' }}" onerror="this.src='{% static 'img/cards/green-office.jpg' %}'" alt="">
                            <div class="task-badges">
                                {% if c.has_visit %}
                                <span class="task-badge visit">VISIT</span>
                                {% endif %}
                    {% if c.has_link %}
                                <span class="task-badge link">LINK</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="body">
                            <h3>{{ c.title }}</h3>
                            <p>{{ c.summary }}</p>
                            <div class="meta">
                                <div class="pill">
                                    <strong>{% if meta.lang == 'ko' %}í’€{% elif meta.lang == 'ja' %}ãƒ—ãƒ¼ãƒ«{% elif meta.lang == 'zh' %}å¥–åŠ±æ± {% else %}Pool{% endif %}</strong>
                                    &nbsp; {{ c.pool_usdt }} USDT
                                </div>
                                <div class="pill">
                                    <strong>{% if meta.lang == 'ko' %}ì°¸ì—¬ì{% elif meta.lang == 'ja' %}äººæ•°{% elif meta.lang == 'zh' %}å‚ä¸è€…{% else %}People{% endif %}</strong>
                                    &nbsp; {{ c.participants }}
                                </div>
                            </div>
                            <div class="progress">
                                <div class="bar" data-pct="{{ c.claimed_percent|default:0 }}"></div>
                            </div>
                            <div style="display:flex; justify-content:space-between; font-size:12px; color:#9fb0aa;">
                                <span>{{ c.claimed_percent|default:0 }}% {% if meta.lang == 'ko' %}ìˆ˜ë ¹{% elif meta.lang == 'ja' %}å—é ˜æ¸ˆ{% elif meta.lang == 'zh' %}å·²é¢†å–{% else %}claimed{% endif %}</span>
                                <span>{{ c.start|date:"Y-m-d" }} â†’ {{ c.end|date:"Y-m-d" }}</span>
                            </div>
                            <div class="foot">
                                <a class="btn" href="/rewards/{{ c.slug }}-{{ c.id }}/">
                                    {% if meta.lang == 'ko' %}ìì„¸íˆ{% elif meta.lang == 'ja' %}è©³ç´°{% elif meta.lang == 'zh' %}è¯¦æƒ…{% else %}Details{% endif %}
                                </a>
                            </div>
                        </div>
                    </article>
                    {% endfor %}
          {% else %}
                    <div class="empty-state" style="grid-column:1/-1">
                        <h3>{% if meta.lang == 'ko' %}ì§„í–‰ì¤‘ì¸ ìº í˜ì¸ì´ ì—†ìŠµë‹ˆë‹¤{% elif meta.lang == 'ja' %}é€²è¡Œä¸­ã®ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“{% elif meta.lang == 'zh' %}æš‚æ— è¿›è¡Œä¸­çš„æ´»åŠ¨{% else %}No live campaigns right now{% endif %}</h3>
                        <p>{% if meta.lang == 'ko' %}ìƒˆ ìº í˜ì¸ì´ ê³§ ê³µê°œë©ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.{% elif meta.lang == 'ja' %}æ–°ã—ã„ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã¯è¿‘æ—¥å…¬é–‹äºˆå®šã§ã™ã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ã”ç¢ºèªãã ã•ã„ã€‚{% elif meta.lang == 'zh' %}æ–°çš„æ´»åŠ¨å³å°†ä¸Šçº¿ï¼Œè¯·ç¨åå†æŸ¥çœ‹ã€‚{% else %}New campaigns launch soonâ€”check back later.{% endif %}</p>
                    </div>
                    {% endif %}
                </div>
            </section>
            <!-- PAST -->
            <section id="past" class="panel" aria-labelledby="tab-past">
                <div class="grid" id="pastGrid">
                    {% if past_projects %}
            {% for c in past_projects %}
                    <article
                        class="project-card"
                        data-start="{{ c.start|date:'Y-m-d' }}"
                        data-end="{{ c.end|date:'Y-m-d' }}"
                        data-pool="{{ c.pool_usdt|default:0 }}"
                        data-payout="{{ c.payout_usdt|default:0 }}"
                        data-pop="{{ c.participants|default:0 }}"
                    >
                        <div class="thumb">
                            <img src="{{ c.image_url|default:'' }}" onerror="this.src='{% static 'img/cards/neon-city.jpg' %}'" alt="">
                            <div class="task-badges">
                                {% if c.has_visit %}
                                <span class="task-badge visit">VISIT</span>
                                {% endif %}
                    {% if c.has_link %}
                                <span class="task-badge link">LINK</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="body">
                            <h3>{{ c.title }}</h3>
                            <p>{{ c.summary }}</p>
                            <div class="meta">
                                <div class="pill">
                                    <strong>{% if meta.lang == 'ko' %}í’€{% elif meta.lang == 'ja' %}ãƒ—ãƒ¼ãƒ«{% elif meta.lang == 'zh' %}å¥–åŠ±æ± {% else %}Pool{% endif %}</strong>
                                    &nbsp; {{ c.pool_usdt }} USDT
                                </div>
                                <div class="pill">
                                    <strong>{% if meta.lang == 'ko' %}ì°¸ì—¬ì{% elif meta.lang == 'ja' %}äººæ•°{% elif meta.lang == 'zh' %}å‚ä¸è€…{% else %}People{% endif %}</strong>
                                    &nbsp; {{ c.participants }}
                                </div>
                            </div>
                            <div class="progress">
                                <div class="bar" data-pct="100"></div>
                            </div>
                            <div style="display:flex; justify-content:space-between; font-size:12px; color:#9fb0aa;">
                                <span>100% {% if meta.lang == 'ko' %}ìˆ˜ë ¹{% elif meta.lang == 'ja' %}å—é ˜æ¸ˆ{% elif meta.lang == 'zh' %}å·²é¢†å–{% else %}claimed{% endif %}</span>
                                <span>{{ c.start|date:"Y-m-d" }} â†’ {{ c.end|date:"Y-m-d" }}</span>
                            </div>
                            <div class="foot">
                                <a class="btn" href="/rewards/{{ c.slug }}-{{ c.id }}/">
                                    {% if meta.lang == 'ko' %}ìš”ì•½{% elif meta.lang == 'ja' %}ã‚µãƒãƒªãƒ¼{% elif meta.lang == 'zh' %}æ€»ç»“{% else %}Summary{% endif %}
                                </a>
                            </div>
                        </div>
                    </article>
                    {% endfor %}
          {% else %}
                    <div class="empty-state" style="grid-column:1/-1">
                        <h3>{% if meta.lang == 'ko' %}ì§€ë‚œ ìº í˜ì¸ì´ ì—†ìŠµë‹ˆë‹¤{% elif meta.lang == 'ja' %}éå»ã®ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“{% elif meta.lang == 'zh' %}æš‚æ— å†å²æ´»åŠ¨{% else %}No past campaigns yet{% endif %}</h3>
                        <p>{% if meta.lang == 'ko' %}ì™„ë£Œëœ ìº í˜ì¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.{% elif meta.lang == 'ja' %}çµ‚äº†ã—ãŸã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚{% elif meta.lang == 'zh' %}å·²ç»“æŸçš„æ´»åŠ¨ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œã€‚{% else %}Completed campaigns will appear here.{% endif %}</p>
                    </div>
                    {% endif %}
                </div>
            </section>
        </main>
        <!-- ===== Footer ===== -->
        <footer class="footer">
            <div class="container" style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <div>
                    Â©
                    <strong>LinkHash</strong>
                </div>
                <div class="muted">
                    {% if meta.lang == 'ko' %}í™”ì´íŠ¸í–‡ ë°±ë§í¬ Â· íˆ¬ëª…í•œ ë¦¬ì›Œë“œ{% elif meta.lang == 'ja' %}ãƒ›ãƒ¯ã‚¤ãƒˆãƒãƒƒãƒˆè¢«ãƒªãƒ³ã‚¯ãƒ»é€æ˜ãªå ±é…¬{% elif meta.lang == 'zh' %}ç™½å¸½å¤–é“¾ Â· é€æ˜å¥–åŠ±{% else %}White-hat backlinks Â· Transparent rewards{% endif %}
                </div>
            </div>
        </footer>
        <!-- ===== Interactions (no external libs) ===== -->
        <script>
      // Tabs
      const tabs = document.querySelectorAll('.tab');
      const panels = document.querySelectorAll('.panel');
      function switchTab(tab){
        tabs.forEach(t=>{ t.classList.remove('active'); t.setAttribute('aria-selected','false'); });
        panels.forEach(p=> p.classList.remove('active'));
        tab.classList.add('active'); tab.setAttribute('aria-selected','true');
        const target = document.querySelector(tab.dataset.target);
        if(target) target.classList.add('active');
        // refresh animations
        revealCards();
        animateBarsWhenVisible();
      }
      tabs.forEach(tab=> tab.addEventListener('click', ()=> switchTab(tab)));

      // Dropdown (sorting)
      const dd = document.getElementById('sortDropdown');
      const toggle = dd.querySelector('.dropdown-toggle');
      const menu = dd.querySelector('.dropdown-menu');
      const label = dd.querySelector('.dropdown-label');
      toggle.addEventListener('click', (e)=>{
        e.stopPropagation();
        const open = dd.classList.toggle('open');
        toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
      menu.querySelectorAll('[role="option"]').forEach(opt=>{
        opt.tabIndex = 0;
        opt.addEventListener('click', ()=>{
          dd.dataset.value = opt.dataset.value;
          label.textContent = opt.textContent.trim();
          menu.querySelectorAll('[role="option"]').forEach(o=> o.setAttribute('aria-selected', String(o===opt)));
          dd.classList.remove('open'); toggle.setAttribute('aria-expanded','false');
          applySort(); revealCards(); animateBarsWhenVisible();
        });
        opt.addEventListener('keydown', (e)=>{
          if(e.key==='Enter'||e.key===' '){ e.preventDefault(); opt.click(); }
          if(e.key==='Escape'){ dd.classList.remove('open'); toggle.setAttribute('aria-expanded','false'); toggle.focus(); }
        });
      });
      document.addEventListener('click', ()=>{ if(dd.classList.contains('open')){ dd.classList.remove('open'); toggle.setAttribute('aria-expanded','false'); } });

      // Sorting
      const liveGrid = document.getElementById('liveGrid');
      const pastGrid = document.getElementById('pastGrid');
      function parseNum(el, attr){ return parseFloat(el.getAttribute(attr) || '0'); }
      function parseDate(el, attr){ const v = el.getAttribute(attr); return v ? new Date(v+'T00:00:00Z') : new Date(0); }
      function sortGrid(gridEl, mode, isLive=true){
        if(!gridEl) return;
        const cards = Array.from(gridEl.querySelectorAll('.project-card'));
        let sorter = ()=>0;
        if(mode==='ending'){ sorter = (a,b)=> parseDate(a,'data-end') - parseDate(b,'data-end'); if(!isLive) sorter=(a,b)=> parseDate(b,'data-end') - parseDate(a,'data-end'); }
        else if(mode==='new'){ sorter = (a,b)=> parseDate(b,'data-start') - parseDate(a,'data-start'); }
        else if(mode==='payout'){ sorter = (a,b)=> parseNum(b,'data-payout') - parseNum(a,'data-payout'); }
        else if(mode==='pool'){ sorter = (a,b)=> parseNum(b,'data-pool') - parseNum(a,'data-pool'); }
        else if(mode==='popular'){ sorter = (a,b)=> parseNum(b,'data-pop') - parseNum(a,'data-pop'); }
        cards.sort(sorter).forEach(c=> gridEl.appendChild(c));
      }
      function applySort(){
        const mode = dd.dataset.value || 'ending';
        sortGrid(liveGrid, mode, true);
        sortGrid(pastGrid, mode, false);
      }

      // Reveal cards (fade/slide in)
      function revealCards(){
        const cards = document.querySelectorAll('.panel.active .project-card');
        cards.forEach((card, i)=>{
          card.style.transitionDelay = (i*40)+'ms';
          requestAnimationFrame(()=>{ card.style.opacity = '1'; card.style.transform = 'translateY(0)'; });
        });
      }

      // Progress bars on view
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            const b = entry.target;
            const target = ((b.dataset.pct ? b.dataset.pct : '0') + '%');
            b.style.transition = 'width 900ms cubic-bezier(.2,1,.22,1)';
            requestAnimationFrame(()=> b.style.width = target);
            io.unobserve(b);
          }
        });
      }, { threshold: .2 });
      function animateBarsWhenVisible(){
        document.querySelectorAll('.panel.active .progress .bar').forEach(b=> io.observe(b));
      }

      // Initial run
      applySort();
      revealCards();
      animateBarsWhenVisible();
        </script>
        <!-- ===== Wallet + CSRF ===== -->
        <script>
  // ---------- CSRF + API ----------
  function getCookie(name){
    const m = document.cookie.match(new RegExp('(^|; )' + encodeURIComponent(name) + '=([^;]*)'));
    return m ? decodeURIComponent(m[2]) : null;
  }
  async function apiGet(url){
    const r = await fetch(url, { credentials: 'same-origin' });
    if(!r.ok) throw new Error((await r.text()) || ('GET ' + url + ' failed'));
    return r.json();
  }
  async function apiPost(url, json){
    const r = await fetch(url, {
      method: 'POST',
      credentials: 'same-origin',
      headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') || '' },
      body: JSON.stringify(json || {})
    });
    if(!r.ok){
      let msg; try{ msg = (await r.json()).error }catch(e){ msg = await r.text(); }
      throw new Error(msg || ('POST ' + url + ' failed'));
    }
    return r.json();
  }

  // ---------- EIP-1193 provider helpers ----------
  function pickEthereumProvider(){
    // Some wallets expose multiple providers under window.ethereum.providers
    const eth = window.ethereum;
    if(!eth) return null;
    if(Array.isArray(eth.providers)){
      // Prefer MetaMask if present, else first provider
      const mm = eth.providers.find(p => p.isMetaMask);
      return mm || eth.providers[0] || eth;
    }
    return eth;
  }
  function isMobile(){
    return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent || '');
  }

  // Build a MetaMask deep-link to open your site inside the in-app browser
  function buildMetaMaskDeepLink(){
    // MetaMask expects https://metamask.app.link/dapp/<host><path><search><hash> (no scheme on the dapp URL)
    const dapp = location.host + location.pathname + location.search + location.hash;
    return 'https://metamask.app.link/dapp/' + dapp;
  }

  // ---------- Wallet connect flow (desktop + mobile) ----------
  async function connectWallet(){
    try{
      const provider = pickEthereumProvider();

      if(!provider){
        // No injected provider: on mobile, try deep-link into MetaMask; on desktop, show install message
        if(isMobile()){
          // Open in MetaMask app browser
          window.location.href = buildMetaMaskDeepLink();
          return;
        }else{
          alert('MetaMask not detected. Please install MetaMask and refresh.');
          return;
        }
      }

      // Standard EIP-1193 request (works in MetaMask in-app browser on mobile and in desktop extensions)
      const accounts = await provider.request({ method: 'eth_requestAccounts' });
      const address = (accounts && accounts[0]) ? accounts[0] : null;
      if(!address){ alert('No account selected.'); return; }

      // Nonce + signature (SIWE-style)
      const nonceRes = await apiGet(`/api/auth/nonce?address=${encodeURIComponent(address)}`);
      if(!nonceRes.ok){ throw new Error(nonceRes.error || 'nonce error'); }
      const message = nonceRes.message || `LinkHash login\n\nNonce: ${nonceRes.nonce}\n\nThis signature proves you control this wallet.`;

      const signature = await provider.request({
        method: 'personal_sign',
        params: [ message, address ]
      });

      const verifyRes = await apiPost('/api/auth/verify', { address, signature, message });
      if(verifyRes && verifyRes.ok){
        window.location.reload();
      }else{
        alert('Login failed.');
      }
    }catch(err){
      console.error(err);
      alert('Wallet login failed: ' + (err && err.message ? err.message : err));
    }
  }

  async function logoutWallet(){
    try{ await apiPost('/api/auth/logout', {}); window.location.reload(); }
    catch(err){ console.error(err); alert('Logout failed: ' + (err && err.message ? err.message : err)); }
  }

  window.connectWallet = connectWallet;
  window.logoutWallet  = logoutWallet;
        </script>
        <!-- ===== Language switcher ===== -->
        <script>
      (function(){
        const $wrap = document.getElementById('langSwitcher');
        if(!$wrap) return;
        const $btn  = $wrap.querySelector('.lang-btn');
        const $menu = $wrap.querySelector('.lang-menu');
        const current = ($wrap.dataset.current || 'en').toLowerCase();

        const flagEl = $btn.querySelector('.flag-emoji');
        const flagMap = { en:'ğŸ‡ºğŸ‡¸', ko:'ğŸ‡°ğŸ‡·', ja:'ğŸ‡¯ğŸ‡µ', zh:'ğŸ‡¨ğŸ‡³' };
        flagEl.textContent = flagMap[current] || 'ğŸ‡ºğŸ‡¸';

        function close(){ $wrap.classList.remove('open'); $btn.setAttribute('aria-expanded','false'); }
        $btn.addEventListener('click', (e)=>{ e.stopPropagation(); $wrap.classList.toggle('open'); $btn.setAttribute('aria-expanded', $wrap.classList.contains('open')); });
        document.addEventListener('click', ()=> close());
        document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') close(); });

        function pathFor(lang){
          const loc = window.location;
          const path = loc.pathname;
          const clean = path.replace(/^\/(ko|ja|zh)(\/|$)/, '/'); // strip locale prefix if any
          const baseMap = { '/': true, '/rewards/': true, '/events/': true, '/leaderboard/': true };
          const isApply = /^\/rewards\/apply(\/(ko|ja|zh)\/)?$/.test(path);
          if(isApply){ return (lang==='en') ? '/rewards/apply/?lang=en' : `/rewards/apply/${lang}/`; }
          if(baseMap[clean]){
            if(lang==='en'){
              const q = new URLSearchParams(loc.search); q.set('lang','en');
              return clean + (q.toString() ? `?${q.toString()}` : '');
            }
            return clean === '/' ? `/${lang}/` : `/${lang}${clean}`;
          }
          const params = new URLSearchParams(loc.search);
          params.set('lang', lang);
          return path + (params.toString() ? `?${params.toString()}` : '');
        }

        $menu.querySelectorAll('.lang-item').forEach(li=>{
          li.addEventListener('click', ()=>{
            const lang = li.getAttribute('data-lang');
            flagEl.textContent = li.getAttribute('data-flag') || '';
            $wrap.querySelector('.label').textContent =
              lang==='ko' ? 'í•œêµ­ì–´' : lang==='ja' ? 'æ—¥æœ¬èª' : lang==='zh' ? 'ä¸­æ–‡' : 'English';
            close();
            const target = pathFor(lang);
            if(target) window.location.href = target;
          });
        });
      })();
        </script>
        <script>
(function(){
  // Sheet toggle
  const $toggle = document.getElementById('mnavToggle');
  const $sheet  = document.getElementById('mnavSheet');
  if($toggle && $sheet){
    const open = ()=>{ $sheet.hidden = false; $toggle.setAttribute('aria-expanded','true'); document.documentElement.style.overflow='hidden'; };
    const close= ()=>{ $sheet.hidden = true;  $toggle.setAttribute('aria-expanded','false'); document.documentElement.style.overflow=''; };
    $toggle.addEventListener('click', ()=> $sheet.hidden ? open() : close());
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') close(); });

    // Close sheet on outside click (only when open)
    document.addEventListener('click', (e)=>{
      if($sheet.hidden) return;
      const within = e.target.closest('#mnavSheet') || e.target.closest('#mnavToggle');
      if(!within) close();
    });
  }

  // Language switcher (same routing rules as desktop)
  const $wrap = document.getElementById('langSwitcher');
  if($wrap){
    const $btn  = $wrap.querySelector('.lang-btn');
    const $menu = $wrap.querySelector('.lang-menu');
    const current = ($wrap.dataset.current || 'en').toLowerCase();
    const flagEl = $btn.querySelector('.flag-emoji');
    const labelEl= $btn.querySelector('.label');
    const flagMap= { en:'ğŸ‡ºğŸ‡¸', ko:'ğŸ‡°ğŸ‡·', ja:'ğŸ‡¯ğŸ‡µ', zh:'ğŸ‡¨ğŸ‡³' };
    flagEl.textContent = flagMap[current] || 'ğŸ‡ºğŸ‡¸';

    function closeMenu(){ $wrap.classList.remove('open'); $btn.setAttribute('aria-expanded','false'); }
    function openMenu(){  $wrap.classList.add('open');    $btn.setAttribute('aria-expanded','true');  }

    $btn.addEventListener('click', (e)=>{ e.stopPropagation(); $wrap.classList.contains('open') ? closeMenu() : openMenu(); });
    document.addEventListener('click', closeMenu);
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeMenu(); });

    function pathFor(lang){
      const loc = window.location;
      const path = loc.pathname;
      const clean = path.replace(/^\/(ko|ja|zh)(\/|$)/, '/'); // strip locale prefix
      const baseMap = { '/': true, '/rewards/': true, '/events/': true, '/leaderboard/': true };
      const isApply = /^\/rewards\/apply(\/(ko|ja|zh)\/)?$/.test(path);
      if(isApply){
        if(lang === 'en') return '/rewards/apply/?lang=en';
        return `/rewards/apply/${lang}/`;
      }
      if(baseMap[clean]){
        if(lang === 'en'){
          const q = new URLSearchParams(loc.search);
          q.set('lang','en');
          return clean + (q.toString() ? `?${q.toString()}` : '');
        }
        return clean === '/' ? `/${lang}/` : `/${lang}${clean}`;
      }
      const params = new URLSearchParams(loc.search);
      params.set('lang', lang);
      return path + (params.toString() ? `?${params.toString()}` : '');
    }

    $menu.querySelectorAll('.lang-item').forEach(li=>{
      li.addEventListener('click', ()=>{
        const lang  = li.getAttribute('data-lang');
        const emoji = li.getAttribute('data-flag') || '';
        flagEl.textContent = emoji;
        labelEl.textContent = lang==='ko' ? 'í•œêµ­ì–´' : lang==='ja' ? 'æ—¥æœ¬èª' : lang==='zh' ? 'ä¸­æ–‡' : 'English';
        closeMenu();
        const target = pathFor(lang);
        if(target) window.location.href = target;
      });
    });
  }
})();
        </script>
    </body>
</html>
