<!doctype html>
{% load static %}
<html lang="{{ meta.lang|default:'en' }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{{ meta.title }}</title>
        <link rel="canonical" href="{{ meta.canonical }}">
        <meta name="robots" content="index,follow">
        <meta name="author" content="LinkHash">
        <meta name="description" content="{{ meta.description }}">
        <!-- OG -->
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="LinkHash">
        <meta property="og:title" content="{{ meta.og_title }}">
        <meta property="og:description" content="{{ meta.og_description }}">
        <meta property="og:url" content="{{ meta.url }}">
        <meta property="og:image" content="{% static 'img/og-cover.png' %}">
        <!-- Favicons -->
        <link rel="icon" href="{% static 'img/favicon.ico' %}">
        <style>
      /* ===== THEME (match rewards pages) ===== */
      :root{
        --bg:#0a0b0d;
        --bg-elev:#0f1115;
        --panel:#11141a;
        --panel-2:#0e1318;
        --grid:#0b0f13;
        --line:#1a212d;
        --text:#e6f1ee;
        --muted:#9fb0aa;
        --green:#16a34a;
        --green-2:#23d16a;
        --glow:0 0 22px rgba(22,163,74,.35), 0 0 48px rgba(22,163,74,.15);
        --radius:16px;
        --shadow-lg:0 40px 80px rgba(0,0,0,.55), inset 0 -1px 0 rgba(255,255,255,.03);
        --shadow-md:0 16px 40px rgba(0,0,0,.45);
        --noise:transparent url('data:image/svg+xml;utf8,\
          <svg xmlns="http://www.w3.org/2000/svg" width=\"120\" height=\"120\" viewBox=\"0 0 120 120\">\
          <filter id=\"n\"><feTurbulence type=\"fractalNoise\" baseFrequency=\"0.9\" numOctaves=\"2\" stitchTiles=\"stitch\"/></filter>\
          <rect width=\"120\" height=\"120\" filter=\"url(%23n)\" opacity=\".04\"/></svg>') repeat;
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0; color:var(--text);
        background:
          radial-gradient(80rem 60rem at 90% -10%, rgba(22,163,74,.12), transparent 60%),
          radial-gradient(60rem 40rem at -20% 20%, rgba(35,209,106,.08), transparent 60%),
          linear-gradient(180deg, #08090b, #0a0b0d 20%, #090c10);
        font-family: ui-sans-serif, "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
        letter-spacing:.2px;
        background-attachment: fixed;
      }
      a{color:inherit;text-decoration:none}
      .container{width:1200px; margin:0 auto; padding:0 20px;}

      /* ===== NAV (sticky, blurred) ===== */
      .nav{
        position:sticky; top:0; z-index:60;
        backdrop-filter: blur(10px);
        background:linear-gradient(180deg, rgba(15,17,21,.65), rgba(15,17,21,.35));
        border-bottom:1px solid rgba(255,255,255,.06);
      }
      .nav .row{display:flex; align-items:center; justify-content:space-between; height:72px;}
      .brand{
        display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.4px;
        color:#d8ffe7;
        text-shadow:0 0 18px rgba(35,209,106,.24);
      }
      .brand .dot{width:10px;height:10px;border-radius:999px;background:var(--green);box-shadow:var(--glow)}
      .links{display:flex; gap:24px; align-items:center;}
      .links a{color:#cfe7dd; opacity:.9}
      .links a:hover{color:#fff; text-shadow:0 0 12px rgba(35,209,106,.25)}
      .btn{display:inline-flex; align-items:center; gap:10px; padding:12px 16px; font-weight:700; border-radius:12px; background:linear-gradient(180deg,#19b357,#119e49); color:#05160c; box-shadow:var(--glow); border:1px solid #2fe07a}
      .btn-outline{padding:10px 14px; border-radius:12px; border:1px solid #2a333f; background: rgba(14,18,25,.6); color:#d9f6e6}
      .lang{display:flex; gap:10px; align-items:center;}
      .lang a{padding:8px 10px; border:1px solid #2a333f; border-radius:10px; color:#cfe7dd}
      .lang a.active{border-color:#2fe07a; color:#eafff4; box-shadow:var(--glow)}

      /* ===== PAGE HEADER ===== */
      .page-head{
        padding:50px 0 10px;
        background:linear-gradient(180deg, rgba(12,16,20,.65), rgba(10,12,16,.35)), var(--noise);
        border-bottom:1px solid rgba(255,255,255,.06);
      }
      .page-head h1{margin:0 0 10px; font-size:36px; letter-spacing:.3px;}
      .page-head .sub{color:var(--muted); margin:0}

      /* ===== LAYOUT ===== */
      .board{
        display:grid; grid-template-columns:2fr 1fr; gap:18px; padding:22px 0 36px;
      }

      /* ===== CARDS ===== */
      .card{
        background:linear-gradient(180deg, #0f1419, #0c1116);
        border:1px solid rgba(255,255,255,.06);
        border-radius:18px;
        box-shadow:var(--shadow-md);
        padding:16px;
      }

      /* Post item */
      .post{
        position:relative;
        display:grid; grid-template-columns:200px 1fr; gap:16px;
        border:1px solid rgba(255,255,255,.06);
        border-radius:16px; padding:12px;
        background:linear-gradient(180deg, #0d1217, #0b0f14);
        transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
        overflow:hidden;
      }
      .post::after{
        content:""; position:absolute; inset:-20%; pointer-events:none; opacity:0;
        background:radial-gradient(70% 60% at 30% 0%, rgba(35,209,106,.14), transparent 60%);
        transition:opacity .2s ease;
      }
      .post:hover{
        transform:translateY(-3px) scale(1.02);
        border-color:rgba(35,209,106,.35);
        box-shadow:0 40px 80px rgba(22,163,74,.18), var(--shadow-md);
      }
      .post:hover::after{ opacity:1; }

      .thumb{
        width:100%; height:180px; border-radius:14px; border:1px solid #1d2836;
        background:#0b1117; overflow:hidden;
      }
      .thumb img{width:100%; height:100%; object-fit:contain; display:block; background:#0b1117}

      .title{font-size:18px; font-weight:800; margin:0 0 6px}
      .meta{font-size:12px; color:var(--muted); margin:6px 0 10px}

      .tags{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
      .tag{
        display:inline-flex; align-items:center; gap:6px; padding:6px 10px;
        border:1px solid #1d2836; background:#0b1218; border-radius:999px; font-size:12px; color:#cde6da; font-weight:700;
      }

      .rule{
        margin-top:12px; padding:12px; border:1px solid #1d2836;
        background:#0b1218; border-radius:12px; color:#cfe7dd; font-size:13px;
      }
      .rule strong{font-weight:800; color:#eafff4}

      /* Aside card (notes) */
      .aside h3{margin:0 0 10px; font-size:18px}
      .aside .muted{color:var(--muted); margin:0}

      /* Footer */
      .footer{padding:28px 0; border-top:1px solid rgba(255,255,255,.06); color:#a7b9b1; background:#0a0c10;}

      /* Responsive (desktop-first) */
      @media (max-width:1140px){ .container{width:1000px} }
      @media (max-width:1000px){
        .container{width:920px}
        .board{grid-template-columns:1fr}
        .post{grid-template-columns:160px 1fr}
        .thumb{height:140px}
      }
      @media (max-width:680px){
        .post{grid-template-columns:1fr}
        .thumb{height:180px}
      }
        /* ===== Language dropdown (nav) ===== */
      .lang{ position:relative; margin-left:8px; }
      .lang-btn{
        display:inline-flex; align-items:center; gap:10px;
        padding:10px 12px; font-weight:700; border-radius:12px;
        border:1px solid #2a333f; background: rgba(14,18,25,.6); color:#d9f6e6;
        cursor:pointer;
      }
      .lang-btn:hover{ border-color:rgba(35,209,106,.35); box-shadow:0 0 16px rgba(35,209,106,.18) }
      .lang .chev{ opacity:.8 }

      .lang-menu{
        position:absolute; top:110%; right:0; width:210px;
        background:linear-gradient(180deg, #0f1419, #0c1116);
        border:1px solid rgba(255,255,255,.08);
        border-radius:12px; box-shadow:0 20px 40px rgba(0,0,0,.45);
        padding:6px; display:none; z-index:70;
      }
      .lang.open .lang-menu{ display:block; animation:menuIn .14s ease-out }
      @keyframes menuIn{ from{ transform:translateY(-6px); opacity:0 } to{ transform:translateY(0); opacity:1 } }

      .lang-item{
        display:flex; align-items:center; gap:10px; padding:10px 10px; border-radius:10px;
        cursor:pointer; color:#cfe7dd; font-weight:700;
      }
      .lang-item:hover{ background:#0b1218; border:1px solid #1d2836 }

      .flag-emoji{
        display:inline-flex; align-items:center; justify-content:center;
        width:18px; height:18px; line-height:18px;
        font-size:14px; border-radius:3px;
        background:rgba(255,255,255,.06);
        box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);
      }
      /* keep existing .links row spacing happy */
      .links{ display:flex; gap:24px; align-items:center; }
        </style>
    </head>
    <body>
        <!-- ===== NAV ===== -->
        <header class="nav">
            <div class="container row">
                <div class="brand">
                    <span class="dot"></span>
                    <span>LinkHash</span>
                </div>
                <nav class="links">
                    <!-- Left: same 4 links + Apply -->
                    <a href="{% if meta.lang == 'ko' %}/ko/{% elif meta.lang == 'ja' %}/ja/{% elif meta.lang == 'zh' %}/zh/{% else %}/{% endif %}">
                        {% if meta.lang == 'ko' %}홈{% elif meta.lang == 'ja' %}ホーム{% elif meta.lang == 'zh' %}主页{% else %}Home{% endif %}
                    </a>
                    <a href="{% if meta.lang == 'ko' %}/ko/rewards/{% elif meta.lang == 'ja' %}/ja/rewards/{% elif meta.lang == 'zh' %}/zh/rewards/{% else %}/rewards/{% endif %}">
                        {% if meta.lang == 'ko' %}리워드{% elif meta.lang == 'ja' %}リワード{% elif meta.lang == 'zh' %}奖励{% else %}Rewards{% endif %}
                    </a>
                    <a href="{% if meta.lang == 'ko' %}/ko/events/{% elif meta.lang == 'ja' %}/ja/events/{% elif meta.lang == 'zh' %}/zh/events/{% else %}/events/{% endif %}" style="font-weight:700;color:#d8ffe7">
                        {% if meta.lang == 'ko' %}이벤트{% elif meta.lang == 'ja' %}イベント{% elif meta.lang == 'zh' %}活动{% else %}Events{% endif %}
                    </a>
                    <a href="{% if meta.lang == 'ko' %}/ko/leaderboard/{% elif meta.lang == 'ja' %}/ja/leaderboard/{% elif meta.lang == 'zh' %}/zh/leaderboard/{% else %}/leaderboard/{% endif %}">
                        {% if meta.lang == 'ko' %}리더보드{% elif meta.lang == 'ja' %}リーダーボード{% elif meta.lang == 'zh' %}排行榜{% else %}Leaderboard{% endif %}
                    </a>
                    <a class="btn-outline" href="{% if meta.lang == 'ko' %}/rewards/apply/ko/{% elif meta.lang == 'ja' %}/rewards/apply/ja/{% elif meta.lang == 'zh' %}/rewards/apply/zh/{% else %}/rewards/apply/{% endif %}">
                        {% if meta.lang == 'ko' %}캠페인 신청{% elif meta.lang == 'ja' %}キャンペーン申請{% elif meta.lang == 'zh' %}申请发起活动{% else %}Apply for campaign{% endif %}
                    </a>
                    <!-- Wallet button (unchanged) -->
                    {% if wallet_user %}
                    <span class="btn-outline">👛 {{ wallet_user.address|slice:":6" }}…{{ wallet_user.address|slice:"-4:" }}</span>
                    <a class="btn" href="#" onclick="logoutWallet && logoutWallet();return false;">
                        {% if meta.lang == 'ko' %}로그아웃{% elif meta.lang == 'ja' %}ダッシュボード{% elif meta.lang == 'zh' %}仪表盘{% else %}Logout{% endif %}
                    </a>
                    {% else %}
                    <a class="btn" href="#" onclick="connectWallet && connectWallet();return false;">
                        {% if meta.lang == 'ko' %}지갑 연결{% elif meta.lang == 'ja' %}ウォレット接続{% elif meta.lang == 'zh' %}连接钱包{% else %}Connect Wallet{% endif %}
                    </a>
                    {% endif %}
                    <!-- NEW: Language dropdown (to the RIGHT of wallet button) -->
                    <!-- NEW: Language dropdown (to the RIGHT of wallet button) -->
                    <!-- NEW: Language dropdown (to the RIGHT of wallet button) -->
                    <div class="lang" id="langSwitcher" data-current="{{ meta.lang|default:'en' }}">
                        <button
                            class="lang-btn"
                            type="button"
                            aria-haspopup="listbox"
                            aria-expanded="false"
                        >
                            <span class="flag-emoji" aria-hidden="true"></span>
                            <span class="label">
                                {% if meta.lang == 'ko' %}한국어{% elif meta.lang == 'ja' %}日本語{% elif meta.lang == 'zh' %}中文{% else %}English{% endif %}
                            </span>
                            <svg
                                class="chev"
                                viewBox="0 0 20 20"
                                width="16"
                                height="16"
                                aria-hidden="true"
                            >
                                <path
                                    d="M5 7l5 6 5-6"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    stroke-linecap="round"
                                />
                            </svg>
                        </button>
                        <ul
                            class="lang-menu"
                            role="listbox"
                            tabindex="-1"
                            aria-label="Select language"
                        >
                            <li
                                class="lang-item"
                                role="option"
                                data-lang="en"
                                data-flag="🇺🇸"
                            >🇺🇸 English</li>
                            <li
                                class="lang-item"
                                role="option"
                                data-lang="ko"
                                data-flag="🇰🇷"
                            >🇰🇷 한국어</li>
                            <li
                                class="lang-item"
                                role="option"
                                data-lang="ja"
                                data-flag="🇯🇵"
                            >🇯🇵 日本語</li>
                            <li
                                class="lang-item"
                                role="option"
                                data-lang="zh"
                                data-flag="🇨🇳"
                            >🇨🇳 中文</li>
                        </ul>
                    </div>
                </nav>
            </div>
        </header>
        <!-- ===== PAGE HEADER ===== -->
        <section class="page-head">
            <div class="container">
                <h1>{% if meta.lang == 'ko' %}이벤트 & 공지{% else %}Events & Announcements{% endif %}</h1>
                <p class="sub">
                    {% if meta.lang == 'ko' %}최신 이벤트와 공지사항을 확인하세요.{% else %}Check out our latest announcements and community events.{% endif %}
                </p>
            </div>
        </section>
        <!-- ===== BOARD ===== -->
        <main class="container board">
            <!-- LEFT: Posts list -->
            <section class="card">
                <!-- Post #1: PEPE -->
                <article class="post">
                    <div class="thumb">
                        <img src="{% static 'img/events/pepe_pepper.png' %}" alt="PEPE Airdrop">
                    </div>
                    <div class="content">
                        <h3 class="title">
                            {% if meta.lang == 'ko' %}
                링크 공유 과제에 참여하는
                            <strong>첫 100명</strong>
                            에게 1인당
                            <strong>PEPE 1,000,000</strong>
                            에어드랍!
              {% else %}
                First
                            <strong>100 participants</strong>
                            in the Link Sharing Task get
                            <strong>1,000,000 PEPE</strong>
                            each!
              {% endif %}
                        </h3>
                        <p class="meta">{% if meta.lang == 'ko' %}공지 날짜{% else %}Posted on{% endif %}: 2025-09-13</p>
                        <div class="tags">
                            {% if meta.lang == 'ko' %}
                            <span class="tag">#밈코인&nbsp;이벤트</span>
                            <span class="tag">#에어드랍</span>
                            <span class="tag">#PEPE</span>
                            <span class="tag">#알트시즌</span>
                            {% else %}
                            <span class="tag">#meme&nbsp;coin&nbsp;event</span>
                            <span class="tag">#airdrop</span>
                            <span class="tag">#PEPE</span>
                            <span class="tag">#Altseason</span>
                            {% endif %}
                        </div>
                        <!-- Rule: Ethereum only -->
                        <div class="rule">
                            {% if meta.lang == 'ko' %}
                            <strong>지급 안내:</strong>
                            <u>이더리움 지갑 주소(0x…)</u>
                            로 참여한 경우에만
                            <strong>PEPE(ERC-20)</strong>
                            으로 지급됩니다.
              {% else %}
                            <strong>Payout:</strong>
                            <u>Only for Ethereum wallet addresses (0x…)</u>
                            , rewards are paid in
                            <strong>PEPE (ERC-20)</strong>
                            .
              {% endif %}
                        </div>
                    </div>
                </article>
                <!-- Post #2: BONK -->
                <article class="post" style="margin-top:16px">
                    <div class="thumb">
                        <img src="{% static 'img/events/bonk_pepper.png' %}" alt="BONK Airdrop">
                    </div>
                    <div class="content">
                        <h3 class="title">
                            {% if meta.lang == 'ko' %}
                솔라나 지갑 사용자 보너스!
                            <strong>첫 100명</strong>
                            에게 1인당
                            <strong>BONK 500,000</strong>
                            에어드랍
              {% else %}
                Bonus for Solana wallets!
                            <strong>First 100</strong>
                            get
                            <strong>500,000 BONK</strong>
                            each
              {% endif %}
                        </h3>
                        <p class="meta">{% if meta.lang == 'ko' %}공지 날짜{% else %}Posted on{% endif %}: 2025-09-13</p>
                        <div class="tags">
                            {% if meta.lang == 'ko' %}
                            <span class="tag">#봉크</span>
                            <span class="tag">#솔라나</span>
                            <span class="tag">#에어드랍</span>
                            {% else %}
                            <span class="tag">#BONK</span>
                            <span class="tag">#Solana</span>
                            <span class="tag">#airdrop</span>
                            {% endif %}
                        </div>
                        <!-- Rule: Solana only -->
                        <div class="rule">
                            {% if meta.lang == 'ko' %}
                            <strong>지급 안내:</strong>
                            <u>솔라나 지갑 주소(Base58)</u>
                            로 참여한 경우에만
                            <strong>BONK(SPL)</strong>
                            으로 지급됩니다.
              {% else %}
                            <strong>Payout:</strong>
                            <u>Only for Solana wallet addresses (base58)</u>
                            , rewards are paid in
                            <strong>BONK (SPL)</strong>
                            .
              {% endif %}
                        </div>
                    </div>
                </article>
            </section>
            <!-- RIGHT: Notes -->
            <aside class="card aside">
                <h3>{% if meta.lang == 'ko' %}안내{% else %}Notes{% endif %}</h3>
                <p class="muted">
                    {% if meta.lang == 'ko' %}
            에어드랍은 과제 검수 후 순차 지급됩니다. 봇/중복 참여는 제외될 수 있습니다.
          {% else %}
            Airdrops are distributed after review. Bot/duplicate entries may be excluded.
          {% endif %}
                </p>
                <div style="margin-top:14px; display:flex; gap:10px;">
                    <a class="btn" href="{% url 'rewards_en' %}">
                        {% if meta.lang == 'ko' %}리워드 프로그램 바로가기{% else %}Go to Rewards Program{% endif %}
                    </a>
                    <a class="btn-outline" href="/rewards/apply/">
                        {% if meta.lang == 'ko' %}캠페인 신청{% else %}Apply for a Campaign{% endif %}
                    </a>
                </div>
            </aside>
        </main>
        <!-- ===== FOOTER ===== -->
        <footer class="footer">
            <div class="container" style="display:flex; align-items:center; justify-content:space-between;">
                <div>
                    ©
                    <strong>LinkHash</strong>
                </div>
                <div style="opacity:.7">White-hat backlinks · Transparent rewards</div>
            </div>
        </footer>
        <script>
          (function(){
            const $wrap = document.getElementById('langSwitcher');
            if(!$wrap) return;
            const $btn  = $wrap.querySelector('.lang-btn');
            const $menu = $wrap.querySelector('.lang-menu');
            const current = ($wrap.dataset.current || 'en').toLowerCase();

            const flagEl = $btn.querySelector('.flag-emoji');
            const flagMap = { en:'🇺🇸', ko:'🇰🇷', ja:'🇯🇵', zh:'🇨🇳' };
            flagEl.textContent = flagMap[current] || '🇺🇸';

            function open(){ $wrap.classList.add('open'); $btn.setAttribute('aria-expanded','true'); }
            function close(){ $wrap.classList.remove('open'); $btn.setAttribute('aria-expanded','false'); }
            $btn.addEventListener('click', (e)=>{ e.stopPropagation(); $wrap.classList.toggle('open'); $btn.setAttribute('aria-expanded', $wrap.classList.contains('open')); });
            document.addEventListener('click', ()=> close());
            document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') close(); });

            function pathFor(lang){
              const loc = window.location;
              const path = loc.pathname;
              const clean = path.replace(/^\/(ko|ja|zh)(\/|$)/, '/'); // strip locale prefix if any

              const baseMap = { '/': true, '/rewards/': true, '/events/': true, '/leaderboard/': true };

              // /rewards/apply/ variants
              const isApply = /^\/rewards\/apply(\/(ko|ja|zh)\/)?$/.test(path);
              if(isApply){
                if(lang === 'en') return '/rewards/apply/?lang=en';
                return `/rewards/apply/${lang}/`;
              }

              if(baseMap[clean]){
                if(lang === 'en'){
                  const q = new URLSearchParams(loc.search);
                  q.set('lang','en');
                  return clean + (q.toString() ? `?${q.toString()}` : '');
                }
                return clean === '/' ? `/${lang}/` : `/${lang}${clean}`;
              }

              // Unknown/other page (e.g., /rewards/some-slug-5/) → keep path, toggle ?lang=xx
              const params = new URLSearchParams(loc.search);
              params.set('lang', lang);
              return path + (params.toString() ? `?${params.toString()}` : '');
            }

            $menu.querySelectorAll('.lang-item').forEach(li=>{
              li.addEventListener('click', ()=>{
                const lang = li.getAttribute('data-lang');
                const emoji = li.getAttribute('data-flag') || '';
                flagEl.textContent = emoji;
                $wrap.querySelector('.label').textContent =
                  lang==='ko' ? '한국어' : lang==='ja' ? '日本語' : lang==='zh' ? '中文' : 'English';
                close();
                const target = pathFor(lang);
                if(target) window.location.href = target;
              });
            });
          })();
        </script>
        <script>
    // --- CSRF helper ---
    function getCookie(name){
        const m = document.cookie.match(new RegExp('(^|; )' + encodeURIComponent(name) + '=([^;]*)'));
        return m ? decodeURIComponent(m[2]) : null;
    }
    async function apiGet(url){
        const r = await fetch(url, { credentials: 'same-origin' });
        if(!r.ok) throw new Error((await r.text()) || ('GET ' + url + ' failed'));
        return r.json();
    }
    async function apiPost(url, json){
        const r = await fetch(url, {
        method: 'POST',
        credentials: 'same-origin',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken') || ''
        },
        body: JSON.stringify(json || {})
        });
        if(!r.ok){
        let msg;
        try{ msg = (await r.json()).error }catch(e){ msg = await r.text(); }
        throw new Error(msg || ('POST ' + url + ' failed'));
        }
        return r.json();
    }

    // --- Wallet login ---
    async function connectWallet(){
        try{
        if(!window.ethereum){
            alert('MetaMask not detected. Please install MetaMask.');
            return;
        }
        // 1) Request account
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const address = (accounts && accounts[0]) ? accounts[0] : null;
        if(!address){ alert('No account selected.'); return; }

        // 2) Ask backend for a fresh nonce + canonical message
        const nonceRes = await apiGet(`/api/auth/nonce?address=${encodeURIComponent(address)}`);
        if(!nonceRes.ok){ throw new Error(nonceRes.error || 'nonce error'); }
        const message = nonceRes.message || `LinkHash login\n\nNonce: ${nonceRes.nonce}\n\nThis signature proves you control this wallet.`;

        // 3) Sign exact message provided by server
        const signature = await window.ethereum.request({
            method: 'personal_sign',
            params: [ message, address ]
        });

        // 4) Verify on server (sets session)
        const verifyRes = await apiPost('/api/auth/verify', { address, signature, message });
        if(verifyRes && verifyRes.ok){
            window.location.reload();
        }else{
            alert('Login failed.');
        }
        }catch(err){
        console.error(err);
        alert('Wallet login failed: ' + (err && err.message ? err.message : err));
        }
    }

    async function logoutWallet(){
        try{
        await apiPost('/api/auth/logout', {});
        window.location.reload();
        }catch(err){
        console.error(err);
        alert('Logout failed: ' + (err && err.message ? err.message : err));
        }
    }

    // Expose to inline onclick handlers
    window.connectWallet = connectWallet;
    window.logoutWallet  = logoutWallet;
        </script>
    </body>
</html>
